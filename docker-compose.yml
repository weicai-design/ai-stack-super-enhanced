version: '3.8'

services:
  # AIäº¤äº’ä¸­å¿ƒ
  ai-chat-center:
    build:
      context: ./ai-chat-center
      dockerfile: Dockerfile
    container_name: ai-chat-center
    ports:
      - "8020:8020"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://ollama:11434}
      - DATABASE_URL=sqlite:///./data/chat.db
    volumes:
      - ./ai-chat-center/data:/app/data
      - ./logs:/app/logs
    depends_on:
      - ollama
    networks:
      - ai-stack-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8020/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # RAGçŸ¥è¯†ç³»ç»Ÿ
  rag-system:
    build:
      context: ./ğŸ“š Enhanced RAG & Knowledge Graph
      dockerfile: Dockerfile
    container_name: rag-system
    ports:
      - "8011:8011"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DATABASE_URL=sqlite:///./data/rag.db
    volumes:
      - ./ğŸ“š Enhanced RAG & Knowledge Graph/data:/app/data
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # ERPç³»ç»Ÿ
  erp-system:
    build:
      context: ./ğŸ’¼ Intelligent ERP & Business Management
      dockerfile: Dockerfile
    container_name: erp-system
    ports:
      - "8013:8013"
    environment:
      - DATABASE_URL=sqlite:///./data/erp.db
    volumes:
      - ./ğŸ’¼ Intelligent ERP & Business Management/data:/app/data
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # è‚¡ç¥¨äº¤æ˜“ç³»ç»Ÿ
  stock-trading:
    build:
      context: ./ğŸ“ˆ Intelligent Stock Trading
      dockerfile: Dockerfile
    container_name: stock-trading
    ports:
      - "8014:8014"
    environment:
      - DATABASE_URL=sqlite:///./data/stock.db
    volumes:
      - ./ğŸ“ˆ Intelligent Stock Trading/data:/app/data
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # è¶‹åŠ¿åˆ†æç³»ç»Ÿ
  trend-analysis:
    build:
      context: ./ğŸ” Intelligent Trend Analysis
      dockerfile: Dockerfile
    container_name: trend-analysis
    ports:
      - "8015:8015"
    volumes:
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # å†…å®¹åˆ›ä½œç³»ç»Ÿ
  content-creation:
    build:
      context: ./ğŸ¨ Intelligent Content Creation
      dockerfile: Dockerfile
    container_name: content-creation
    ports:
      - "8016:8016"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    volumes:
      - ./ğŸ¨ Intelligent Content Creation/data:/app/data
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # ä»»åŠ¡ä»£ç†ç³»ç»Ÿ
  task-agent:
    build:
      context: ./ğŸ¤– Intelligent Task Agent
      dockerfile: Dockerfile
    container_name: task-agent
    ports:
      - "8017:8017"
    volumes:
      - ./logs:/app/logs
    networks:
      - ai-stack-network
    restart: unless-stopped

  # èµ„æºç®¡ç†ç³»ç»Ÿ
  resource-management:
    build:
      context: ./âš™ï¸ System Resource Management
      dockerfile: Dockerfile
    container_name: resource-management
    ports:
      - "8018:8018"
    volumes:
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - ai-stack-network
    restart: unless-stopped
    privileged: true

  # è‡ªæˆ‘å­¦ä¹ ç³»ç»Ÿ
  self-learning:
    build:
      context: ./ğŸ§  Self Learning System
      dockerfile: Dockerfile
    container_name: self-learning
    ports:
      - "8019:8019"
    environment:
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://ollama:11434}
    volumes:
      - ./ğŸ§  Self Learning System/data:/app/data
      - ./logs:/app/logs
    depends_on:
      - ollama
    networks:
      - ai-stack-network
    restart: unless-stopped

  # OllamaæœåŠ¡
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama-data:/root/.ollama
    networks:
      - ai-stack-network
    restart: unless-stopped

  # Nginxåå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: ai-stack-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
      - ./unified-dashboard:/usr/share/nginx/html:ro
    depends_on:
      - ai-chat-center
      - rag-system
      - erp-system
    networks:
      - ai-stack-network
    restart: unless-stopped

networks:
  ai-stack-network:
    driver: bridge

volumes:
  ollama-data:

## P2-001 · 四级功能深化

**交付日期**：2025-11-19  
**目标**：在原有三级功能树（模块 → 阶段 → 视图）基础上，补充第四级「能力单元」拆解，并在前端/后端实现可视化联动。

---

### 1. 新增能力地图

| 文件 | 说明 |
| --- | --- |
| `core/function_hierarchy.py` | 定义 `FOUR_LEVEL_FUNCTIONS`，覆盖 RAG、内容、趋势、运营财务、AI 编程等视图下的能力单元（责任人、产出）。 |
| `core/module_registry.py` | 为每个视图注入 `capabilities` 列表，使 `/modules/tree` 与 `/modules/view-data` 保持一致的层级结构。 |

### 2. API 扩展

- `GET /api/super-agent/modules/view-capabilities?module=&stage=&view=`：返回指定视图的四级能力数据，供前端或其他系统调用。
- 原 `/modules/tree`、`/modules/view-data` 自动包含能力信息（view 节点中带 `capabilities`）。

### 3. 前端体验

- `web/three_level.html` + `web/js/modules_three.js` 新增“能力单元”面板：  
  - 在右侧视图面板下方展示四级能力；  
  - 切换视图时自动调用 `/modules/view-capabilities` 并渲染责任人/产出。  
  - 一键查看「模块 → 阶段 → 视图 → 能力」全链路，实现四级深化的可视化。

---

### 4. 验证

| 项目 | 结果 |
| --- | --- |
| 语法 | `py_compile` + `read_lints` 覆盖新/改文件通过。 |
| 运行 | 打开 “模块三级界面” 页面，点击任一视图可实时展示四级能力（来自 `FOUR_LEVEL_FUNCTIONS`）；API 返回 JSON 数据可供第三方系统读取。 |
| 架构 | 四级能力抽象与模块树/视图数据解耦，后续可通过配置/数据库扩展；前端与 API 通过统一接口联动，无需硬编码。 |
| 依赖 | 未新增依赖，沿用现有前端/后端栈。 |
| 合规 | 能力信息仅描述内部流程，不触发数据写入；前端展示遵循现有权限体系。 |
| 闭环 | “能力配置 → API → 前端面板” 构成闭环，可用于验收/演示四级功能拆解。 |
| 生产性 | 数据源来自配置文件，可在生产环境直接维护；无需模拟数据。 |

---

> 后续可将 `FOUR_LEVEL_FUNCTIONS` 接入数据库或 CMS，结合 `/modules/view-data` 的实时指标，实现「指标 + 能力 + 责任人」三位一体的运营视图。


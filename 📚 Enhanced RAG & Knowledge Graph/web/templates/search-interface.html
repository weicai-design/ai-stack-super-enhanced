<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½æœç´¢ - AI Stackè¶…çº§å¢å¼ºç‰ˆ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/rag-enhanced.css') }}">
    <style>
        .search-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .search-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .search-main {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        .search-input-group {
            position: relative;
            margin-bottom: 30px;
        }

        .search-input {
            width: 100%;
            padding: 20px 60px 20px 30px;
            font-size: 18px;
            border: 2px solid #e1e5e9;
            border-radius: 50px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .search-btn:hover {
            background: #0056b3;
        }

        .search-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-option {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-option.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .filters-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .search-results {
            margin-top: 30px;
        }

        .results-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-count {
            color: #6c757d;
        }

        .sort-options {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .result-item {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .result-item:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);
        }

        .result-header {
            display: flex;
            justify-content: between;
            align-items: start;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: #007bff;
            margin: 0;
        }

        .result-source {
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #6c757d;
        }

        .result-preview {
            color: #495057;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .result-meta {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #6c757d;
        }

        .highlight {
            background: #fff3cd;
            padding: 0 2px;
            border-radius: 2px;
        }

        .confidence-score {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .confidence-bar {
            width: 60px;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: #28a745;
            transition: width 0.3s ease;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .page-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .page-btn:hover:not(.active) {
            background: #f8f9fa;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .suggestions {
            margin-top: 20px;
        }

        .suggestion-title {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .suggestion-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .suggestion-item {
            background: #e7f1ff;
            color: #007bff;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .suggestion-item:hover {
            background: #007bff;
            color: white;
        }

        .loading-indicator {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .advanced-search-toggle {
            text-align: center;
            margin: 10px 0;
        }

        .toggle-btn {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 14px;
        }

        .related-concepts {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .concepts-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .concepts-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .concept-tag {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            padding: 4px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .concept-tag:hover {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <!-- æœç´¢å¤´éƒ¨ -->
        <div class="search-header">
            <h1>æ™ºèƒ½è¯­ä¹‰æœç´¢</h1>
            <p>åŸºäºAI Stackè¶…çº§å¢å¼ºç‰ˆçš„RAGå’ŒçŸ¥è¯†å›¾è°±æŠ€æœ¯</p>
        </div>

        <!-- ä¸»è¦æœç´¢åŒºåŸŸ -->
        <div class="search-main">
            <!-- æœç´¢è¾“å…¥ -->
            <div class="search-input-group">
                <input type="text" id="search-query" class="search-input" placeholder="è¾“å…¥æ‚¨è¦æœç´¢çš„å†…å®¹..." autocomplete="off">
                <button id="search-button" class="search-btn">
                    <span style="font-size: 18px;">ğŸ”</span>
                </button>
            </div>

            <!-- æœç´¢é€‰é¡¹ -->
            <div class="search-options">
                <div class="search-option active" data-scope="all">å…¨éƒ¨å†…å®¹</div>
                <div class="search-option" data-scope="documents">æ–‡æ¡£</div>
                <div class="search-option" data-scope="images">å›¾ç‰‡</div>
                <div class="search-option" data-scope="audio">éŸ³é¢‘</div>
                <div class="search-option" data-scope="video">è§†é¢‘</div>
                <div class="search-option" data-scope="knowledge">çŸ¥è¯†å›¾è°±</div>
            </div>

            <!-- é«˜çº§æœç´¢åˆ‡æ¢ -->
            <div class="advanced-search-toggle">
                <button class="toggle-btn" id="toggle-advanced-search">
                    + é«˜çº§æœç´¢é€‰é¡¹
                </button>
            </div>

            <!-- é«˜çº§æœç´¢é¢æ¿ -->
            <div id="advanced-search-panel" class="filters-panel hidden">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="filter-group">
                        <label for="file-type">æ–‡ä»¶ç±»å‹</label>
                        <select id="file-type" class="filter-select">
                            <option value="">æ‰€æœ‰ç±»å‹</option>
                            <option value="pdf">PDFæ–‡æ¡£</option>
                            <option value="doc">Wordæ–‡æ¡£</option>
                            <option value="ppt">æ¼”ç¤ºæ–‡ç¨¿</option>
                            <option value="image">å›¾ç‰‡æ–‡ä»¶</option>
                            <option value="audio">éŸ³é¢‘æ–‡ä»¶</option>
                            <option value="video">è§†é¢‘æ–‡ä»¶</option>
                            <option value="code">ä»£ç æ–‡ä»¶</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="date-range">æ—¶é—´èŒƒå›´</label>
                        <select id="date-range" class="filter-select">
                            <option value="">æ‰€æœ‰æ—¶é—´</option>
                            <option value="today">ä»Šå¤©</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="month">æœ¬æœˆ</option>
                            <option value="year">ä»Šå¹´</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="confidence-threshold">ç½®ä¿¡åº¦é˜ˆå€¼</label>
                        <input type="range" id="confidence-threshold" min="0" max="100" value="80" class="filter-select">
                        <span id="confidence-value">80%</span>
                    </div>

                    <div class="filter-group">
                        <label for="sort-by">æ’åºæ–¹å¼</label>
                        <select id="sort-by" class="filter-select">
                            <option value="relevance">ç›¸å…³æ€§</option>
                            <option value="date-desc">æœ€æ–°ä¼˜å…ˆ</option>
                            <option value="date-asc">æœ€æ—§ä¼˜å…ˆ</option>
                            <option value="confidence">ç½®ä¿¡åº¦</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- æœç´¢å»ºè®® -->
            <div id="search-suggestions" class="suggestions hidden">
                <div class="suggestion-title">æœç´¢å»ºè®®ï¼š</div>
                <div class="suggestion-list" id="suggestion-list"></div>
            </div>
        </div>

        <!-- æœç´¢ç»“æœ -->
        <div class="search-results">
            <div class="results-header">
                <div class="results-count" id="results-count">è¯·è¾“å…¥æœç´¢è¯</div>
                <div class="sort-options hidden" id="sort-options">
                    <span>æ’åº:</span>
                    <select id="results-sort">
                        <option value="relevance">ç›¸å…³æ€§</option>
                        <option value="date">æ—¥æœŸ</option>
                        <option value="confidence">ç½®ä¿¡åº¦</option>
                    </select>
                </div>
            </div>

            <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
            <div id="results-list">
                <div class="no-results">
                    <div style="font-size: 48px; margin-bottom: 20px;">ğŸ”</div>
                    <h3>å¼€å§‹æœç´¢</h3>
                    <p>ä½¿ç”¨ä¸Šæ–¹çš„æœç´¢æ¡†æŸ¥æ‰¾æ‚¨éœ€è¦çš„ä¿¡æ¯</p>
                </div>
            </div>

            <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
            <div id="loading-indicator" class="loading-indicator hidden">
                <div class="spinner"></div>
                <p>æ­£åœ¨æœç´¢ä¸­...</p>
            </div>

            <!-- ç›¸å…³æ¦‚å¿µ -->
            <div id="related-concepts" class="related-concepts hidden">
                <div class="concepts-title">ç›¸å…³æ¦‚å¿µï¼š</div>
                <div class="concepts-list" id="concepts-list"></div>
            </div>

            <!-- åˆ†é¡µ -->
            <div class="pagination hidden" id="pagination">
                <button class="page-btn" id="prev-page">ä¸Šä¸€é¡µ</button>
                <div id="page-numbers"></div>
                <button class="page-btn" id="next-page">ä¸‹ä¸€é¡µ</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/real-time-search.js') }}"></script>
    <script>
        // æœç´¢ç•Œé¢äº¤äº’é€»è¾‘
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-query');
            const searchButton = document.getElementById('search-button');
            const searchOptions = document.querySelectorAll('.search-option');
            const advancedSearchPanel = document.getElementById('advanced-search-panel');
            const toggleAdvancedBtn = document.getElementById('toggle-advanced-search');
            const confidenceSlider = document.getElementById('confidence-threshold');
            const confidenceValue = document.getElementById('confidence-value');

            // æœç´¢é€‰é¡¹åˆ‡æ¢
            searchOptions.forEach(option => {
                option.addEventListener('click', function() {
                    searchOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // é«˜çº§æœç´¢åˆ‡æ¢
            toggleAdvancedBtn.addEventListener('click', function() {
                advancedSearchPanel.classList.toggle('hidden');
                this.textContent = advancedSearchPanel.classList.contains('hidden')
                    ? '+ é«˜çº§æœç´¢é€‰é¡¹'
                    : '- éšè—é«˜çº§é€‰é¡¹';
            });

            // ç½®ä¿¡åº¦æ»‘å—
            confidenceSlider.addEventListener('input', function() {
                confidenceValue.textContent = this.value + '%';
            });

            // æœç´¢åŠŸèƒ½
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            function performSearch() {
                const query = searchInput.value.trim();
                if (query) {
                    // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
                    document.getElementById('loading-indicator').classList.remove('hidden');
                    document.getElementById('results-list').innerHTML = '';

                    // æ¨¡æ‹Ÿæœç´¢è¿‡ç¨‹
                    setTimeout(() => {
                        displaySearchResults(query);
                    }, 1000);
                }
            }

            function displaySearchResults(query) {
                // è¿™é‡Œåº”è¯¥è°ƒç”¨å®é™…çš„æœç´¢API
                // ç›®å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                const resultsList = document.getElementById('results-list');
                const resultsCount = document.getElementById('results-count');
                const sortOptions = document.getElementById('sort-options');
                const pagination = document.getElementById('pagination');
                const relatedConcepts = document.getElementById('related-concepts');

                // æ˜¾ç¤ºç»“æœè®¡æ•°å’Œæ§ä»¶
                resultsCount.textContent = `æ‰¾åˆ° 15 ä¸ªç›¸å…³ç»“æœ (æœç´¢è¯: "${query}")`;
                sortOptions.classList.remove('hidden');
                pagination.classList.remove('hidden');
                relatedConcepts.classList.remove('hidden');

                // éšè—åŠ è½½æŒ‡ç¤ºå™¨
                document.getElementById('loading-indicator').classList.add('hidden');

                // æ˜¾ç¤ºæ¨¡æ‹Ÿç»“æœ
                resultsList.innerHTML = `
                    <div class="result-item">
                        <div class="result-header">
                            <h3 class="result-title">AI Stackè¶…çº§å¢å¼ºç‰ˆå¼€å‘æ–‡æ¡£</h3>
                            <span class="result-source">PDFæ–‡æ¡£</span>
                        </div>
                        <div class="result-preview">
                            æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†<mark class="highlight">AI Stackè¶…çº§å¢å¼ºç‰ˆ</mark>çš„ç³»ç»Ÿæ¶æ„ã€åŠŸèƒ½æ¨¡å—å’ŒæŠ€æœ¯å®ç°ç»†èŠ‚ã€‚åŒ…å«RAGç³»ç»Ÿã€çŸ¥è¯†å›¾è°±ã€æ–‡ä»¶ç®¡ç†ç­‰æ ¸å¿ƒç»„ä»¶çš„å®Œæ•´è¯´æ˜ã€‚
                        </div>
                        <div class="result-meta">
                            <span>ä¿®æ”¹æ—¶é—´: 2024-01-15</span>
                            <span>æ–‡ä»¶å¤§å°: 2.3 MB</span>
                            <span class="confidence-score">
                                ç½®ä¿¡åº¦:
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: 95%"></div>
                                </div>
                                95%
                            </span>
                        </div>
                    </div>

                    <div class="result-item">
                        <div class="result-header">
                            <h3 class="result-title">çŸ¥è¯†å›¾è°±æ„å»ºæŒ‡å—</h3>
                            <span class="result-source">çŸ¥è¯†åº“æ¡ç›®</span>
                        </div>
                        <div class="result-preview">
                            å¦‚ä½•æ„å»ºå’Œç»´æŠ¤ä¼ä¸šçº§<mark class="highlight">çŸ¥è¯†å›¾è°±</mark>ï¼ŒåŒ…æ‹¬å®ä½“è¯†åˆ«ã€å…³ç³»æŠ½å–ã€å›¾è°±å­˜å‚¨å’Œå¯è§†åŒ–ç­‰å…³é”®æŠ€æœ¯ã€‚
                        </div>
                        <div class="result-meta">
                            <span>æ›´æ–°æ—¶é—´: 2024-01-14</span>
                            <span>æ¥æº: å†…éƒ¨çŸ¥è¯†åº“</span>
                            <span class="confidence-score">
                                ç½®ä¿¡åº¦:
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: 88%"></div>
                                </div>
                                88%
                            </span>
                        </div>
                    </div>
                `;

                // æ˜¾ç¤ºç›¸å…³æ¦‚å¿µ
                document.getElementById('concepts-list').innerHTML = `
                    <div class="concept-tag">RAGç³»ç»Ÿ</div>
                    <div class="concept-tag">å‘é‡æ•°æ®åº“</div>
                    <div class="concept-tag">è¯­ä¹‰æœç´¢</div>
                    <div class="concept-tag">å®ä½“è¯†åˆ«</div>
                    <div class="concept-tag">å…³ç³»æŠ½å–</div>
                `;
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†å›¾è°±å¯è§†åŒ– - AI-STACK</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="static/css/kg-visualization.css">
</head>
<body>
    <div class="kg-container">
        <!-- å·¥å…·æ  -->
        <div class="kg-toolbar">
            <h2>ğŸ“Š çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h2>
            <div class="toolbar-actions">
                <button class="btn" onclick="resetView()">é‡ç½®è§†å›¾</button>
                <button class="btn" onclick="exportGraph()">å¯¼å‡ºå›¾è°±</button>
                <button class="btn" onclick="toggle2D3D()">åˆ‡æ¢2D/3D</button>
                <button class="btn" onclick="refreshGraph()">åˆ·æ–°</button>
            </div>
        </div>

        <div class="kg-main-layout">
            <!-- å›¾è°±å¯è§†åŒ–åŒºåŸŸ -->
            <div class="kg-visualization-area">
                <div id="knowledge-graph" class="kg-canvas">
                    <!-- çŸ¥è¯†å›¾è°±å°†é€šè¿‡D3.jsåŠ¨æ€æ¸²æŸ“ -->
                </div>
            </div>

            <!-- ä¾§è¾¹ä¿¡æ¯é¢æ¿ -->
            <div class="kg-sidebar">
                <div class="sidebar-section">
                    <h3>å›¾è°±ç»Ÿè®¡</h3>
                    <div class="stat-item">
                        <span>èŠ‚ç‚¹æ•°:</span>
                        <span id="node-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>å…³ç³»æ•°:</span>
                        <span id="edge-count">0</span>
                    </div>
                    <div class="stat-item">
                        <span>å®ä½“ç±»å‹:</span>
                        <span id="entity-types">0</span>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>èŠ‚ç‚¹ä¿¡æ¯</h3>
                    <div id="node-info" class="node-info">
                        <p class="placeholder">ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>ç­›é€‰é€‰é¡¹</h3>
                    <div class="filter-group">
                        <label>
                            <input type="checkbox" id="filter-person" checked>
                            äººç‰©
                        </label>
                        <label>
                            <input type="checkbox" id="filter-organization" checked>
                            ç»„ç»‡
                        </label>
                        <label>
                            <input type="checkbox" id="filter-location" checked>
                            åœ°ç‚¹
                        </label>
                        <label>
                            <input type="checkbox" id="filter-concept" checked>
                            æ¦‚å¿µ
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/kg-visualizer.js"></script>
    <script>
        // åˆå§‹åŒ–çŸ¥è¯†å›¾è°±å¯è§†åŒ–å™¨
        let kgVisualizer = null;

        async function initKnowledgeGraph() {
            try {
                // ä»APIè·å–å›¾è°±æ•°æ®
                const response = await fetch('/api/v5/rag/kg/visualization');
                const data = await response.json();

                // åˆå§‹åŒ–å¯è§†åŒ–å™¨
                kgVisualizer = new KnowledgeGraphVisualizer('knowledge-graph', {
                    width: document.querySelector('.kg-visualization-area').clientWidth,
                    height: document.querySelector('.kg-visualization-area').clientHeight
                });

                // æ›´æ–°å›¾è°±æ•°æ®
                kgVisualizer.updateGraph(data);

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                document.getElementById('node-count').textContent = data.nodes?.length || 0;
                document.getElementById('edge-count').textContent = data.links?.length || 0;
                
                const entityTypes = new Set(data.nodes?.map(n => n.type) || []);
                document.getElementById('entity-types').textContent = entityTypes.size;
            } catch (error) {
                console.error('åŠ è½½çŸ¥è¯†å›¾è°±å¤±è´¥:', error);
            }
        }

        function resetView() {
            if (kgVisualizer) {
                kgVisualizer.resetView();
            }
        }

        function exportGraph() {
            // TODO: å®ç°å¯¼å‡ºåŠŸèƒ½
            alert('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        function toggle2D3D() {
            // TODO: å®ç°2D/3Dåˆ‡æ¢
            alert('2D/3Dåˆ‡æ¢åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function refreshGraph() {
            initKnowledgeGraph();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', initKnowledgeGraph);
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>RAGé¢„å¤„ç† - æ¸…æ´—</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
            margin: 0;
            background: #f4f7fb;
            color: #1f2933;
        }
        .header {
            background: linear-gradient(135deg, #1a237e, #3949ab);
            color: white;
            padding: 30px 40px;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
        }
        .header h1 {
            margin: 0;
            font-size: 30px;
        }
        .header p {
            margin-top: 8px;
            opacity: 0.85;
        }
        .container {
            max-width: 1100px;
            margin: -40px auto 40px;
            padding: 0 25px;
        }
        .card {
            background: white;
            border-radius: 18px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 25px rgba(15,23,42,0.08);
        }
        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
        }
        .step {
            border: 1px solid #e3e8f0;
            border-radius: 12px;
            padding: 15px;
        }
        .step strong {
            display: block;
            color: #1a237e;
            margin-bottom: 6px;
        }
        .actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        button {
            border: none;
            border-radius: 999px;
            padding: 12px 26px;
            font-size: 14px;
            cursor: pointer;
            color: white;
            background: linear-gradient(135deg, #3949ab, #5c6bc0);
            box-shadow: 0 10px 20px rgba(57,73,171,0.25);
        }
        button.secondary {
            background: transparent;
            color: #3949ab;
            border: 1px solid rgba(57,73,171,0.4);
            box-shadow: none;
        }
        .status {
            margin-top: 15px;
            font-size: 13px;
            color: #546e7a;
        }
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 12px;
            background: rgba(63,81,181,0.1);
            color: #3f51b5;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§¼ æ¸…æ´—ï¼ˆCleaningï¼‰é˜¶æ®µ</h1>
        <p>HTMLå‰¥ç¦» / ç©ºç™½æ§åˆ¶ / æ®µè½ç»“æ„åŒ– / å…ƒæ•°æ®æŠ½å– â€”â€” æ„å»ºæœ€æ´å‡€çš„å…¥åº“åŸæ–™ã€‚</p>
    </div>
    <div class="container">
        <div class="card">
            <div class="section-title">æ ¸å¿ƒä»»åŠ¡ <span class="badge">Stage 1 / 4</span></div>
            <div class="steps">
                <div class="step">
                    <strong>1.1 æ ‡ç­¾å‰¥ç¦»</strong>
                    DOMè§£æï¼Œç§»é™¤HTML/JS/CSSï¼Œå¹¶ä¿æŠ¤å…¬å¼ã€ä»£ç å—ã€‚
                </div>
                <div class="step">
                    <strong>1.2 å™ªå£°æ¸…ç†</strong>
                    è¿‡æ»¤è„šæ³¨ã€å¹¿å‘Šã€é‡å¤æç¤ºï¼Œè§„èŒƒç©ºç™½ä¸æ§åˆ¶å­—ç¬¦ã€‚
                </div>
                <div class="step">
                    <strong>1.3 æ®µè½åˆ‡åˆ†</strong>
                    åŸºäºè¯­ä¹‰å’Œæ ‡ç‚¹çš„å¤šç­–ç•¥åˆ‡åˆ†ï¼Œé™„å¸¦å±‚çº§ä¿¡æ¯ã€‚
                </div>
                <div class="step">
                    <strong>1.4 å…ƒæ•°æ®è¡¥å…¨</strong>
                    è‡ªåŠ¨æŠ½å–æ ‡é¢˜ã€ä½œè€…ã€æ¥æºã€æ—¶é—´ä¸ä¸»é¢˜æ ‡ç­¾ã€‚
                </div>
            </div>
            <div class="actions">
                <button onclick="runStage()">âš¡ æ‰§è¡Œæ¸…æ´—</button>
                <button class="secondary" onclick="openPipeline()">æŸ¥çœ‹å››ä»¶å¥—ç¼–æ’</button>
            </div>
            <div class="status" id="statusText">ç­‰å¾…ä»»åŠ¡...</div>
        </div>
    </div>
    <script>
        const STATUS_MAP = {
            idle: 'å¾…å‘½',
            queued: 'æ’é˜Ÿ',
            running: 'æ‰§è¡Œä¸­',
            success: 'å·²å®Œæˆ',
            failed: 'å¤±è´¥'
        };

        async function runStage() {
            const status = document.getElementById('statusText');
            status.textContent = 'æ­£åœ¨è°ƒåº¦æ¸…æ´—ä»»åŠ¡...';
            try {
                const resp = await fetch('/preprocess/run/clean', { method: 'POST' });
                const result = await resp.json();
                if (!resp.ok) {
                    throw new Error(result.detail || result.message || 'è°ƒåº¦å¤±è´¥');
                }
                const stageState = result.stage_state || {};
                const statusText = STATUS_MAP[stageState.status] || stageState.status || 'å·²æäº¤';
                status.textContent = `${stageState.label || 'æ¸…æ´—'}ï¼š${stageState.detail || ''}ï¼ˆ${statusText}ï¼‰`;
            } catch (error) {
                status.textContent = 'è°ƒåº¦å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯');
            }
        }
        function openPipeline() {
            window.open('/preprocess', '_blank');
        }
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>RAGé¢„å¤„ç† - æ ‡å‡†åŒ–</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "PingFang SC"; background: #f7f9fc; margin: 0; color: #102a43; }
        .header { background: linear-gradient(135deg, #004e92, #000428); color: white; padding: 35px 45px; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .header h1 { margin: 0; font-size: 32px; }
        .header p { opacity: 0.85; margin-top: 10px; }
        .container { max-width: 1100px; margin: -40px auto 40px; padding: 0 25px; }
        .card { background: white; border-radius: 20px; padding: 28px 32px; margin-bottom: 25px; box-shadow: 0 12px 28px rgba(15,23,42,0.12); }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 18px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
        .item { border: 1px solid #d9e2ec; border-radius: 14px; padding: 16px; }
        .item strong { display: block; color: #004e92; margin-bottom: 6px; }
        .actions { display: flex; gap: 14px; flex-wrap: wrap; margin-top: 20px; }
        button { border: none; border-radius: 999px; padding: 12px 28px; font-size: 14px; cursor: pointer; color: white; background: linear-gradient(135deg, #0f2027, #2c5364); box-shadow: 0 12px 22px rgba(15,32,39,0.25); }
        button.secondary { background: transparent; color: #0f4c81; border: 1px solid rgba(15,76,129,0.5); box-shadow: none; }
        .status { margin-top: 15px; font-size: 13px; color: #627d98; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ“ æ ‡å‡†åŒ–ï¼ˆStandardizeï¼‰é˜¶æ®µ</h1>
        <p>ç»Ÿä¸€ç¼–ç  / ç« èŠ‚ç»“æ„ / è¯­è¨€é£æ ¼ / æ•°æ®æ ¼å¼ï¼Œä¸ºçŸ¥è¯†åº“å…¥åº“æ‰“é€ å¯æ§æ¨¡æ¿ã€‚</p>
    </div>
    <div class="container">
        <div class="card">
            <div class="section-title">æ ¸å¿ƒä»»åŠ¡ <span style="font-size:12px; margin-left:10px; color:#c1d3fe;">Stage 2 / 4</span></div>
            <div class="grid">
                <div class="item">
                    <strong>2.1 ç¼–ç ä¸è¯­è¨€</strong>
                    è‡ªåŠ¨æ£€æµ‹ç¼–ç ã€è¯­è¨€ï¼Œç»Ÿä¸€ä¸º UTF-8 + æŒ‡å®šè¯­è¨€åŸŸã€‚
                </div>
                <div class="item">
                    <strong>2.2 ç« èŠ‚ç»“æ„åŒ–</strong>
                    å¤šçº§æ ‡é¢˜å¯¹é½ï¼Œè¡¥é½ç¼ºå¤±ç« èŠ‚ï¼Œç”Ÿæˆå±‚çº§æ ‘ã€‚
                </div>
                <div class="item">
                    <strong>2.3 æ•°å­¦/ä»£ç è§„èŒƒ</strong>
                    LaTeXã€å…¬å¼ã€ä»£ç æ®µç»Ÿä¸€åŒ…è£…ä¸è½¬ä¹‰ã€‚
                </div>
                <div class="item">
                    <strong>2.4 å­—æ®µæ˜ å°„</strong>
                    å°†åŸå§‹å­—æ®µæ˜ å°„åˆ°çŸ¥è¯†åº“ schemaï¼Œç”Ÿæˆç»“æ„åŒ–JSONã€‚
                </div>
            </div>
            <div class="actions">
                <button onclick="runStage()">âš¡ æ‰§è¡Œæ ‡å‡†åŒ–</button>
                <button class="secondary" onclick="openPipeline()">è¿”å›ç¼–æ’è§†å›¾</button>
            </div>
            <div class="status" id="statusText">ç­‰å¾…ä»»åŠ¡...</div>
        </div>
    </div>
    <script>
        const STATUS_MAP = {
            idle: 'å¾…å‘½',
            queued: 'æ’é˜Ÿ',
            running: 'æ‰§è¡Œä¸­',
            success: 'å·²å®Œæˆ',
            failed: 'å¤±è´¥'
        };

        async function runStage() {
            const status = document.getElementById('statusText');
            status.textContent = 'æ­£åœ¨è°ƒåº¦æ ‡å‡†åŒ–ä»»åŠ¡...';
            try {
                const resp = await fetch('/preprocess/run/standardize', { method: 'POST' });
                const result = await resp.json();
                if (!resp.ok) {
                    throw new Error(result.detail || result.message || 'è°ƒåº¦å¤±è´¥');
                }
                const stageState = result.stage_state || {};
                const statusText = STATUS_MAP[stageState.status] || stageState.status || 'å·²æäº¤';
                status.textContent = `${stageState.label || 'æ ‡å‡†åŒ–'}ï¼š${stageState.detail || ''}ï¼ˆ${statusText}ï¼‰`;
            } catch (error) {
                status.textContent = 'è°ƒåº¦å¤±è´¥ï¼š' + (error.message || 'æœªçŸ¥é”™è¯¯');
            }
        }
        function openPipeline() {
            window.open('/preprocess', '_blank');
        }
    </script>
</body>
</html>


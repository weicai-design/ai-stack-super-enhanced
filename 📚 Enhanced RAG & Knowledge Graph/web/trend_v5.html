<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶‹åŠ¿åˆ†æ V5.0 - AI-STACK</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2563eb; --bg: #0f172a; --surface: #1e293b; --text: #f1f5f9; --border: #334155; }
        body { font-family: Inter, sans-serif; background: var(--bg); color: var(--text); }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .top-nav { background: var(--surface); padding: 1rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .nav-title { font-size: 1.5rem; font-weight: 600; }
        .btn { padding: 0.6rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; background: var(--primary); color: white; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }
        .card { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); }
        .trend-item { background: #334155; padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem; }
        .hot-badge { background: #ef4444; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; }
        .chart-container { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); margin-top: 1.5rem; }
        .chart-wrapper { height: 300px; }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="nav-title">ğŸ“ˆ è¶‹åŠ¿åˆ†æ V5.0</div>
        <button class="btn" onclick="window.history.back()">â† è¿”å›</button>
    </div>
    <div class="container">
        <div class="card-grid">
            <div class="card"><h3>ğŸ”¥ çƒ­ç‚¹è¯é¢˜</h3><div style="margin-top: 1rem;">
                <div class="trend-item"><span class="hot-badge">HOT</span> AIæŠ€æœ¯å‘å±• <span style="float:right; color: #10b981;">â†‘ 235%</span></div>
                <div class="trend-item">æ–°èƒ½æºæ±½è½¦ <span style="float:right; color: #10b981;">â†‘ 128%</span></div>
                <div class="trend-item">å…ƒå®‡å®™åº”ç”¨ <span style="float:right; color: #10b981;">â†‘ 89%</span></div>
            </div></div>
            <div class="card"><h3>ğŸ“Š æ•°æ®é‡‡é›†</h3><div style="margin-top: 1rem;">
                <p>æ•°æ®æº: <strong>15ä¸ª</strong></p>
                <p>ä»Šæ—¥é‡‡é›†: <strong>12,345æ¡</strong></p>
                <p>å¤„ç†çŠ¶æ€: <strong>è¿è¡Œä¸­</strong></p>
                <button class="btn" style="margin-top: 1rem;">é…ç½®æ•°æ®æº</button>
            </div></div>
            <div class="card"><h3>ğŸ¤– AIåˆ†æ</h3><div style="margin-top: 1rem;">
                <p>å…³é”®è¯æå–: <strong>å®Œæˆ</strong></p>
                <p>æƒ…æ„Ÿåˆ†æ: <strong>å®Œæˆ</strong></p>
                <p>è¶‹åŠ¿é¢„æµ‹: <strong>è¿›è¡Œä¸­</strong></p>
                <button class="btn" style="margin-top: 1rem;">ç”ŸæˆæŠ¥å‘Š</button>
            </div></div>
        </div>
        <div class="chart-container">
            <h3>ğŸ“ˆ è¶‹åŠ¿å˜åŒ–æ›²çº¿</h3>
            <div class="chart-wrapper"><canvas id="trendChart"></canvas></div>
        </div>
    </div>
    <script>
        const ctx = document.getElementById('trendChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: { labels: ['1æ—¥','2æ—¥','3æ—¥','4æ—¥','5æ—¥','6æ—¥','7æ—¥'], datasets: [
                { label: 'AIæŠ€æœ¯', data: [100,120,145,180,210,250,335], borderColor: '#2563eb', tension: 0.4 },
                { label: 'æ–°èƒ½æº', data: [80,85,95,110,125,145,182], borderColor: '#10b981', tension: 0.4 }
            ]},
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#f1f5f9' }}},
                scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' }}, x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' }}}
            }
        });
        
        // ==================== åç«¯APIè¿æ¥ï¼ˆV5.6ï¼‰====================
        
        async function loadTrendData() {
            try {
                console.log('ğŸ“¡ åŠ è½½è¶‹åŠ¿æ•°æ®...');
                const response = await fetch('/api/trend/discover');
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… è¶‹åŠ¿æ•°æ®åŠ è½½æˆåŠŸ', data);
                    
                    // æ›´æ–°çƒ­ç‚¹è¯é¢˜ï¼ˆå¦‚æœAPIè¿”å›ï¼‰
                    if (data.topics && data.topics.length > 0) {
                        const container = document.querySelector('.card:first-child');
                        if (container) {
                            let html = '<h3>ğŸ”¥ çƒ­ç‚¹è¯é¢˜</h3><div style="margin-top: 1rem;">';
                            data.topics.slice(0, 3).forEach((topic, idx) => {
                                const badge = idx === 0 ? '<span class="hot-badge">HOT</span> ' : '';
                                html += `<div class="trend-item">${badge}${topic.name} <span style="float:right; color: #10b981;">â†‘ ${topic.growth}%</span></div>`;
                            });
                            html += '</div>';
                            container.innerHTML = html;
                        }
                    }
                }
            } catch (error) {
                console.warn('âš ï¸  è¶‹åŠ¿APIæœªå°±ç»ªï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®:', error.message);
            }
        }
        
        // ç”ŸæˆæŠ¥å‘ŠåŠŸèƒ½
        document.querySelectorAll('.btn').forEach(btn => {
            if (btn.textContent.includes('ç”ŸæˆæŠ¥å‘Š')) {
                btn.addEventListener('click', async () => {
                    try {
                        const response = await fetch('/api/trend/report', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ period: 'week', format: 'pdf' })
                        });
                        
                        if (response.ok) {
                            alert('âœ… æŠ¥å‘Šç”Ÿæˆä»»åŠ¡å·²æäº¤ï¼');
                        } else {
                            alert('âš ï¸  æŠ¥å‘Šç”ŸæˆåŠŸèƒ½å¼€å‘ä¸­...');
                        }
                    } catch (error) {
                        alert('âš ï¸  åŠŸèƒ½å¼€å‘ä¸­...');
                    }
                });
            }
        });
        
        window.addEventListener('load', loadTrendData);
        
        console.log('âœ… è¶‹åŠ¿åˆ†æV5ç•Œé¢å·²åŠ è½½ï¼ˆV5.6åç«¯è¿æ¥ç‰ˆï¼‰');
    </script>
</body>
</html>

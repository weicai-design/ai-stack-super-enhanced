<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚¡ç¥¨äº¤æ˜“ V5.0 - AI-STACK</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2563eb; --success: #10b981; --error: #ef4444; --bg: #0f172a; --surface: #1e293b; --text: #f1f5f9; --border: #334155; }
        body { font-family: Inter, sans-serif; background: var(--bg); color: var(--text); }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .top-nav { background: var(--surface); padding: 1rem 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .nav-title { font-size: 1.5rem; font-weight: 600; }
        .btn { padding: 0.6rem 1.2rem; border-radius: 8px; border: none; cursor: pointer; background: var(--primary); color: white; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem; }
        .card { background: var(--surface); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border); }
        .stock-price { font-size: 2.5rem; font-weight: 700; }
        .price-up { color: var(--success); }
        .price-down { color: var(--error); }
        .chart-wrapper { height: 300px; margin-top: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="nav-title">ğŸ’° è‚¡ç¥¨äº¤æ˜“ V5.0</div>
        <button class="btn" onclick="window.history.back()">â† è¿”å›</button>
    </div>
    <div class="container">
        <div class="grid">
            <div class="card">
                <h3>ğŸ“Š å®æ—¶è¡Œæƒ…</h3>
                <div style="margin-top: 1rem;">
                    <div>ä¸Šè¯æŒ‡æ•°</div>
                    <div class="stock-price price-up">3,245.67 <span style="font-size: 1rem;">+1.25%</span></div>
                </div>
                <div class="chart-wrapper"><canvas id="priceChart"></canvas></div>
            </div>
            <div class="card">
                <h3>ğŸ’¼ æˆ‘çš„æŒä»“</h3>
                <table>
                    <thead><tr><th>ä»£ç </th><th>åç§°</th><th>æŒä»“</th><th>ç›ˆäº</th></tr></thead>
                    <tbody>
                        <tr><td>600519</td><td>è´µå·èŒ…å°</td><td>100è‚¡</td><td class="price-up">+12.5%</td></tr>
                        <tr><td>000001</td><td>å¹³å®‰é“¶è¡Œ</td><td>500è‚¡</td><td class="price-up">+5.3%</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card" style="margin-top: 1.5rem;">
            <h3>ğŸ¤– ç­–ç•¥å›æµ‹</h3>
            <div style="margin-top: 1rem;">
                <button class="btn">æ–°å»ºç­–ç•¥</button>
                <button class="btn" style="margin-left: 0.5rem;">å¼€å§‹å›æµ‹</button>
                <div style="margin-top: 1rem;">
                    <p>ç­–ç•¥åç§°: <strong>è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥</strong></p>
                    <p>å›æµ‹å‘¨æœŸ: <strong>2024-01-01 è‡³ 2025-11-09</strong></p>
                    <p>å¹´åŒ–æ”¶ç›Š: <strong class="price-up">+28.5%</strong></p>
                    <p>æœ€å¤§å›æ’¤: <strong>-12.3%</strong></p>
                </div>
            </div>
        </div>
    </div>
    <script>
        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: { labels: ['09:30','10:00','10:30','11:00','11:30','13:00','13:30','14:00','14:30','15:00'], 
                datasets: [{ label: 'ä»·æ ¼', data: [3200,3210,3205,3215,3220,3230,3235,3240,3242,3245.67], 
                borderColor: '#10b981', backgroundColor: 'rgba(16,185,129,0.1)', fill: true, tension: 0.4 }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { labels: { color: '#f1f5f9' }}},
                scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' }}, x: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' }}}
            }
        });
        
        // ==================== åç«¯APIè¿æ¥ï¼ˆV5.6ï¼‰====================
        
        async function loadStockData() {
            try {
                console.log('ğŸ“¡ åŠ è½½è‚¡ç¥¨æ•°æ®...');
                const response = await fetch('/api/v5/stock/real/quotes?symbol=000001.SZ');
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… è‚¡ç¥¨æ•°æ®åŠ è½½æˆåŠŸ', data);
                    
                    // æ›´æ–°è‚¡ä»·æ˜¾ç¤º
                    if (data.price) {
                        document.querySelector('.stock-price').textContent = 
                            data.price + ' ' + (data.change_percent > 0 ? '+' : '') + data.change_percent + '%';
                    }
                }
            } catch (error) {
                console.warn('âš ï¸  è‚¡ç¥¨APIæœªå°±ç»ªï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®:', error.message);
            }
        }
        
        // ç­–ç•¥å›æµ‹åŠŸèƒ½
        document.querySelectorAll('.btn').forEach(btn => {
            if (btn.textContent.includes('å›æµ‹')) {
                btn.addEventListener('click', async () => {
                    try {
                        const response = await fetch('/api/v5/stock/real/backtest', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                strategy_name: 'è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥',
                                start_date: '2024-01-01',
                                end_date: '2025-11-09'
                            })
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            alert(`âœ… å›æµ‹å®Œæˆï¼\nå¹´åŒ–æ”¶ç›Š: ${result.annual_return}%\næœ€å¤§å›æ’¤: ${result.max_drawdown}%`);
                        } else {
                            alert('âš ï¸  å›æµ‹åŠŸèƒ½ä½¿ç”¨æ¼”ç¤ºæ•°æ®');
                        }
                    } catch (error) {
                        alert('âš ï¸  å›æµ‹åŠŸèƒ½å¼€å‘ä¸­...');
                    }
                });
            }
        });
        
        window.addEventListener('load', loadStockData);
        
        console.log('âœ… è‚¡ç¥¨äº¤æ˜“V5ç•Œé¢å·²åŠ è½½ï¼ˆV5.6åç«¯è¿æ¥ç‰ˆï¼‰');
    </script>
</body>
</html>

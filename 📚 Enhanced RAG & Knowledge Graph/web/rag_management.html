<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAGçŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ - AI-STACK V4.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", sans-serif;
            background: #f5f7fa;
            height: 100vh;
            overflow: hidden;
        }
        
        .rag-container {
            display: flex;
            height: 100vh;
        }
        
        /* å·¦ä¾§åŠŸèƒ½èœå• */
        .left-menu {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            overflow-y: auto;
        }
        
        .menu-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .menu-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .menu-subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .menu-section {
            padding: 20px 0;
            border-bottom: 1px solid #e8e8e8;
        }
        
        .section-title {
            padding: 0 20px 10px;
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background: #f5f7fa;
        }
        
        .menu-item.active {
            background: #667eea;
            color: white;
            border-left: 3px solid #764ba2;
        }
        
        .menu-icon {
            font-size: 18px;
        }
        
        /* ä¸­é—´å·¥ä½œåŒº */
        .main-workspace {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .workspace-header {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .workspace-title {
            font-size: 22px;
            font-weight: 600;
            color: #333;
        }
        
        .workspace-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: white;
            border: 1px solid #e0e0e0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #f5f7fa;
        }
        
        .workspace-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        /* æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ */
        .upload-zone {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s;
            margin-bottom: 30px;
        }
        
        .upload-zone.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .upload-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }
        
        .upload-hint {
            font-size: 13px;
            color: #666;
        }
        
        .file-input {
            display: none;
        }
        
        /* æ–‡æ¡£åˆ—è¡¨ */
        .doc-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .list-header {
            padding: 20px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .list-filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-input {
            padding: 8px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 13px;
            width: 200px;
        }
        
        .doc-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .doc-table th {
            background: #f5f7fa;
            padding: 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e8e8e8;
        }
        
        .doc-table td {
            padding: 15px;
            border-bottom: 1px solid #e8e8e8;
            font-size: 14px;
        }
        
        .doc-table tr:hover {
            background: #f9f9f9;
        }
        
        .doc-name {
            color: #667eea;
            cursor: pointer;
            font-weight: 500;
        }
        
        .doc-name:hover {
            text-decoration: underline;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-success {
            background: #e8f5e9;
            color: #4caf50;
        }
        
        .status-processing {
            background: #fff3cd;
            color: #ff9800;
        }
        
        .status-error {
            background: #ffebee;
            color: #f44336;
        }
        
        .tag {
            display: inline-block;
            padding: 3px 10px;
            background: #e3f2fd;
            color: #2196f3;
            border-radius: 10px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .action-icon {
            cursor: pointer;
            margin: 0 5px;
            font-size: 16px;
            opacity: 0.6;
            transition: all 0.3s;
        }
        
        .action-icon:hover {
            opacity: 1;
            transform: scale(1.2);
        }
        
        /* å³ä¾§è¯¦æƒ…é¢æ¿ */
        .right-panel {
            width: 350px;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
            overflow-y: auto;
            padding: 30px;
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .info-card {
            background: #f5f7fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        textarea.form-input {
            resize: vertical;
            min-height: 100px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .rag-analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .analytics-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .analytics-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .distribution-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .distribution-bar {
            flex: 1;
            height: 8px;
            border-radius: 999px;
            background: #e5e7eb;
            overflow: hidden;
        }

        .distribution-fill {
            height: 100%;
            background: linear-gradient(90deg, #a855f7, #6366f1);
        }

        .rerank-item {
            border-left: 3px solid #c4b5fd;
            padding-left: 10px;
            margin-bottom: 12px;
        }

        .rerank-meta {
            font-size: 12px;
            color: #64748b;
        }

        .rag-result-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
            font-size: 12px;
            color: #64748b;
        }

        .rag-modality-tag {
            padding: 2px 10px;
            background: #eef2ff;
            color: #4338ca;
            border-radius: 999px;
            font-size: 12px;
        }

        .rag-rerank-score {
            font-weight: 600;
            color: #0f172a;
        }

        .rag-rerank-reason {
            margin-top: 6px;
            font-size: 12px;
            color: #475569;
        }
    </style>
</head>
<body>
    <div class="rag-container">
        <!-- å·¦ä¾§åŠŸèƒ½èœå• -->
        <div class="left-menu">
            <div class="menu-header">
                <div class="menu-title">ğŸ“š RAGçŸ¥è¯†åº“</div>
                <div class="menu-subtitle">V4.0 å®Œæ•´ç®¡ç†ç³»ç»Ÿ</div>
            </div>
            
            <div class="menu-section">
                <div class="section-title">æ ¸å¿ƒåŠŸèƒ½</div>
                <div class="menu-item active" onclick="showSection('documents')">
                    <span class="menu-icon">ğŸ“„</span>
                    <span>æ–‡æ¡£ç®¡ç†</span>
                </div>
                <div class="menu-item" onclick="showSection('search')">
                    <span class="menu-icon">ğŸ”</span>
                    <span>æ£€ç´¢æµ‹è¯•</span>
                </div>
                <div class="menu-item" onclick="showSection('graph')">
                    <span class="menu-icon">ğŸ•¸ï¸</span>
                    <span>çŸ¥è¯†å›¾è°±</span>
                </div>
                <div class="menu-item" onclick="showSection('quality')">
                    <span class="menu-icon">âœ…</span>
                    <span>è´¨é‡ç›‘æ§</span>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="section-title">AIä¸“å®¶åŠ©æ‰‹</div>
                <div class="menu-item" onclick="chatWithExpert('knowledge')">
                    <span class="menu-icon">ğŸ¤–</span>
                    <span>çŸ¥è¯†ç®¡ç†ä¸“å®¶</span>
                </div>
                <div class="menu-item" onclick="chatWithExpert('search')">
                    <span class="menu-icon">ğŸ”</span>
                    <span>æ£€ç´¢ä¼˜åŒ–ä¸“å®¶</span>
                </div>
                <div class="menu-item" onclick="chatWithExpert('graph')">
                    <span class="menu-icon">ğŸ•¸ï¸</span>
                    <span>çŸ¥è¯†å›¾è°±ä¸“å®¶</span>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="section-title">é«˜çº§åŠŸèƒ½</div>
                <div class="menu-item" onclick="showSection('batch')">
                    <span class="menu-icon">ğŸ“¦</span>
                    <span>æ‰¹é‡å¤„ç†</span>
                </div>
                <div class="menu-item" onclick="showSection('analysis')">
                    <span class="menu-icon">ğŸ“Š</span>
                    <span>æ•°æ®åˆ†æ</span>
                </div>
                <div class="menu-item" onclick="showSection('settings')">
                    <span class="menu-icon">âš™ï¸</span>
                    <span>ç³»ç»Ÿè®¾ç½®</span>
                </div>
            </div>
            
            <div class="menu-section">
                <div class="section-title">å¿«é€Ÿæ“ä½œ</div>
                <div class="menu-item" onclick="window.open('/super-agent', '_blank')">
                    <span class="menu-icon">ğŸ’¬</span>
                    <span>è¿”å›èŠå¤©</span>
                </div>
                <div class="menu-item" onclick="window.open('/', '_blank')">
                    <span class="menu-icon">ğŸ </span>
                    <span>ä¸»æ§åˆ¶å°</span>
                </div>
            </div>
        </div>
        
        <!-- ä¸­é—´å·¥ä½œåŒº -->
        <div class="main-workspace">
            <div class="workspace-header">
                <div class="workspace-title" id="workspaceTitle">ğŸ“„ æ–‡æ¡£ç®¡ç†</div>
                <div class="workspace-actions">
                    <button class="action-btn btn-secondary" onclick="refreshData()">
                        ğŸ”„ åˆ·æ–°
                    </button>
                    <button class="action-btn btn-primary" onclick="showUploadModal()">
                        â• ä¸Šä¼ æ–‡æ¡£
                    </button>
                </div>
            </div>
            
            <div class="workspace-content" id="workspaceContent">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“„</div>
                        <div class="stat-label">æ–‡æ¡£æ€»æ•°</div>
                        <div class="stat-value" id="totalDocs">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ”¢</div>
                        <div class="stat-label">å‘é‡æ•°é‡</div>
                        <div class="stat-value" id="totalVectors">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ·ï¸</div>
                        <div class="stat-label">æ ‡ç­¾æ•°é‡</div>
                        <div class="stat-value" id="totalTags">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-label">çŸ¥è¯†å›¾è°±èŠ‚ç‚¹</div>
                        <div class="stat-value" id="totalNodes">0</div>
                    </div>
                </div>
                
                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ </div>
                    <div class="upload-hint">æ”¯æŒ60+ç§æ ¼å¼ï¼šPDFã€Wordã€Excelã€PPTã€å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€ä»£ç ç­‰</div>
                    <input type="file" class="file-input" id="fileInput" multiple accept="*/*" onchange="handleFileSelect(event)">
                    <button class="action-btn btn-primary" onclick="document.getElementById('fileInput').click()" style="margin-top: 20px;">
                        ğŸ“ é€‰æ‹©æ–‡ä»¶
                    </button>
                </div>
                
                <!-- æ–‡æ¡£åˆ—è¡¨ -->
                <div class="doc-list">
                    <div class="list-header">
                        <div class="list-title">ğŸ“š æ–‡æ¡£åˆ—è¡¨</div>
                        <div class="list-filters">
                            <input type="text" class="filter-input" placeholder="ğŸ” æœç´¢æ–‡æ¡£..." id="searchInput" oninput="filterDocs()">
                            <select class="filter-input" id="categoryFilter" onchange="filterDocs()">
                                <option value="">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="æŠ€æœ¯">æŠ€æœ¯</option>
                                <option value="ä¸šåŠ¡">ä¸šåŠ¡</option>
                                <option value="ç®¡ç†">ç®¡ç†</option>
                            </select>
                        </div>
                    </div>
                    <table class="doc-table">
                        <thead>
                            <tr>
                                <th>æ–‡æ¡£åç§°</th>
                                <th>åˆ†ç±»</th>
                                <th>æ ‡ç­¾</th>
                                <th>çŠ¶æ€</th>
                                <th>ä¸Šä¼ æ—¶é—´</th>
                                <th>å¤§å°</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="docTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                    æš‚æ— æ–‡æ¡£ï¼Œè¯·ä¸Šä¼ æ–‡ä»¶
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§è¯¦æƒ…é¢æ¿ -->
        <div class="right-panel">
            <div class="panel-title">ğŸ“Š æ–‡æ¡£è¯¦æƒ…</div>
            
            <div id="docDetails">
                <div style="text-align: center; padding: 40px 0; color: #999;">
                    é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£æŸ¥çœ‹è¯¦æƒ…
                </div>
            </div>
            
            <div class="info-card" style="margin-top: 20px;">
                <div class="info-label">ğŸ¤– AIä¸“å®¶å»ºè®®</div>
                <div class="info-value" style="font-size: 13px; line-height: 1.6; font-weight: normal; color: #666;">
                    <p>ğŸ’¡ å»ºè®®å®šæœŸæ•´ç†æ ‡ç­¾ï¼Œæå‡æ£€ç´¢å‡†ç¡®åº¦</p>
                    <p>ğŸ’¡ å‘é‡åŒ–å®Œæˆåå¯è¿›è¡Œè´¨é‡è¯„ä¼°</p>
                    <p>ğŸ’¡ ä½¿ç”¨çŸ¥è¯†å›¾è°±å‘ç°æ–‡æ¡£é—´çš„å…³è”</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div class="modal" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">ğŸ“¤ ä¸Šä¼ æ–‡æ¡£</div>
            <div class="form-group">
                <label class="form-label">é€‰æ‹©æ–‡ä»¶</label>
                <input type="file" class="form-input" multiple accept="*/*">
            </div>
            <div class="form-group">
                <label class="form-label">åˆ†ç±»</label>
                <select class="form-input">
                    <option>æŠ€æœ¯æ–‡æ¡£</option>
                    <option>ä¸šåŠ¡æ–‡æ¡£</option>
                    <option>ç®¡ç†æ–‡æ¡£</option>
                    <option>å…¶ä»–</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">æ ‡ç­¾ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</label>
                <input type="text" class="form-input" placeholder="AI, æœºå™¨å­¦ä¹ , æ·±åº¦å­¦ä¹ ">
            </div>
            <div class="modal-actions">
                <button class="action-btn btn-secondary" onclick="closeModal('uploadModal')">å–æ¶ˆ</button>
                <button class="action-btn btn-primary" onclick="uploadFiles()">ç¡®è®¤ä¸Šä¼ </button>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = '';
        
        // æ–‡ä»¶æ‹–æ‹½
        const uploadZone = document.getElementById('uploadZone');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.add('dragover');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, () => {
                uploadZone.classList.remove('dragover');
            });
        });
        
        uploadZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            handleFiles(files);
        });
        
        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }
        
        async function handleFiles(files) {
            console.log('å¤„ç†æ–‡ä»¶:', files.length);
            
            for (let file of files) {
                await uploadFile(file);
            }
            
            loadDocuments();
        }
        
        async function uploadFile(file) {
            console.log('ä¸Šä¼ æ–‡ä»¶:', file.name);
            // TODO: å®é™…ä¸Šä¼ åˆ°åç«¯
            
            // æ¨¡æ‹Ÿä¸Šä¼ 
            return new Promise(resolve => setTimeout(resolve, 500));
        }
        
        // æ˜¾ç¤ºä¸åŒçš„åŠŸèƒ½åŒº
        function showSection(section) {
            // æ›´æ–°èœå•çŠ¶æ€
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            const titles = {
                'documents': 'ğŸ“„ æ–‡æ¡£ç®¡ç†',
                'search': 'ğŸ” æ£€ç´¢æµ‹è¯•',
                'graph': 'ğŸ•¸ï¸ çŸ¥è¯†å›¾è°±',
                'quality': 'âœ… è´¨é‡ç›‘æ§',
                'batch': 'ğŸ“¦ æ‰¹é‡å¤„ç†',
                'analysis': 'ğŸ“Š æ•°æ®åˆ†æ',
                'settings': 'âš™ï¸ ç³»ç»Ÿè®¾ç½®'
            };
            
            document.getElementById('workspaceTitle').textContent = titles[section];
            
            // åŠ è½½å¯¹åº”å†…å®¹
            loadSectionContent(section);
        }
        
        async function loadSectionContent(section) {
            const content = document.getElementById('workspaceContent');
            
            switch(section) {
                case 'documents':
                    // å·²ç»æ˜¯é»˜è®¤æ˜¾ç¤º
                    await loadDocuments();
                    break;
                case 'search':
                    await loadSearchInterface();
                    break;
                case 'graph':
                    await loadGraphInterface();
                    break;
                case 'quality':
                    await loadQualityInterface();
                    break;
                default:
                    content.innerHTML = `<div style="padding: 40px; text-align: center; color: #999;">åŠŸèƒ½å¼€å‘ä¸­...</div>`;
            }
        }
        
        async function loadDocuments() {
            try {
                const response = await fetch(API_BASE + '/rag/documents');
                const data = await response.json();
                
                // æ›´æ–°ç»Ÿè®¡
                document.getElementById('totalDocs').textContent = data.total || 0;
                document.getElementById('totalVectors').textContent = data.vectors || 0;
                document.getElementById('totalTags').textContent = data.tags || 0;
                document.getElementById('totalNodes').textContent = data.nodes || 0;
                
                // æ›´æ–°æ–‡æ¡£åˆ—è¡¨
                const tbody = document.getElementById('docTableBody');
                if (data.documents && data.documents.length > 0) {
                    tbody.innerHTML = data.documents.map(doc => `
                        <tr>
                            <td><span class="doc-name" onclick="showDocDetails('${doc.id}')">${doc.name}</span></td>
                            <td>${doc.category || 'æœªåˆ†ç±»'}</td>
                            <td>${(doc.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}</td>
                            <td><span class="status-badge status-${doc.status}">${doc.status === 'success' ? 'å·²å®Œæˆ' : doc.status === 'processing' ? 'å¤„ç†ä¸­' : 'å¤±è´¥'}</span></td>
                            <td>${doc.upload_time || '--'}</td>
                            <td>${formatFileSize(doc.size || 0)}</td>
                            <td>
                                <span class="action-icon" onclick="viewDoc('${doc.id}')" title="æŸ¥çœ‹">ğŸ‘ï¸</span>
                                <span class="action-icon" onclick="editDoc('${doc.id}')" title="ç¼–è¾‘">âœï¸</span>
                                <span class="action-icon" onclick="deleteDoc('${doc.id}')" title="åˆ é™¤">ğŸ—‘ï¸</span>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px; color: #999;">æš‚æ— æ–‡æ¡£ï¼Œè¯·ä¸Šä¼ æ–‡ä»¶</td></tr>';
                }
            } catch (error) {
                console.error('åŠ è½½æ–‡æ¡£å¤±è´¥:', error);
            }
        }
        
        async function loadSearchInterface() {
            const content = document.getElementById('workspaceContent');
            content.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ä»Šæ—¥æŸ¥è¯¢</div>
                        <div class="stat-value">128</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">å¹³å‡ç›¸å…³åº¦</div>
                        <div class="stat-value">92%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">æ£€ç´¢é€Ÿåº¦</div>
                        <div class="stat-value">0.3s</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">ç”¨æˆ·æ»¡æ„åº¦</div>
                        <div class="stat-value">95%</div>
                    </div>
                </div>
                
                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">ğŸ” æ™ºèƒ½æ£€ç´¢æµ‹è¯•</h3>
                    
                    <div class="form-group">
                        <label class="form-label">è¾“å…¥æŸ¥è¯¢å†…å®¹ï¼ˆæ”¯æŒä¸­æ–‡è‡ªç„¶è¯­è¨€ï¼‰</label>
                        <textarea class="form-input" id="searchQuery" placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘æ‰¾ä¸€ä¸‹å…³äºæ·±åº¦å­¦ä¹ çš„èµ„æ–™"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ£€ç´¢å‚æ•°</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 13px; color: #666;">è¿”å›æ•°é‡ï¼ˆTop-Kï¼‰</label>
                                <input type="number" class="form-input" id="searchTopK" value="5" min="1" max="50">
                            </div>
                            <div>
                                <label style="font-size: 13px; color: #666;">ç›¸ä¼¼åº¦é˜ˆå€¼</label>
                                <input type="number" class="form-input" id="searchThreshold" value="0.7" min="0" max="1" step="0.05">
                            </div>
                        </div>
                    </div>
                    
                    <button class="action-btn btn-primary" onclick="performSearch()">ğŸš€ å¼€å§‹æ£€ç´¢</button>

                    <div class="rag-analytics-grid">
                        <div class="analytics-card">
                            <div class="analytics-title">å¤šæ¨¡æ€åˆ†å¸ƒ</div>
                            <div id="ragModalityStats" class="analytics-body" style="min-height:120px; font-size:13px; color:#6b7280;">
                                æš‚æ— æ•°æ®
                            </div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-title">Rerank è§£é‡Š</div>
                            <div id="ragRerankInsights" style="min-height:120px; font-size:13px; color:#475569;">
                                ç­‰å¾…æ£€ç´¢
                            </div>
                        </div>
                        <div class="analytics-card">
                            <div class="analytics-title">æ£€ç´¢ç»Ÿè®¡</div>
                            <div id="ragQueryStats" style="min-height:120px; font-size:13px; color:#475569;">
                                -
                            </div>
                        </div>
                    </div>
                    
                    <div id="searchResults" style="margin-top: 30px;"></div>
                </div>
            `;
        }
        
        async function loadGraphInterface() {
            const content = document.getElementById('workspaceContent');
            content.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); min-height: 600px;">
                    <h3 style="margin-bottom: 20px;">ğŸ•¸ï¸ çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h3>
                    <div style="text-align: center; padding: 60px; color: #999;">
                        <div style="font-size: 60px; margin-bottom: 20px;">ğŸ•¸ï¸</div>
                        <div style="font-size: 16px;">çŸ¥è¯†å›¾è°±æ­£åœ¨åŠ è½½...</div>
                        <div style="font-size: 13px; margin-top: 10px;">éœ€è¦é›†æˆCytoscape.jså›¾è°±åº“</div>
                    </div>
                </div>
            `;
        }
        
        async function loadQualityInterface() {
            const content = document.getElementById('workspaceContent');
            content.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
                    <h3 style="margin-bottom: 20px;">âœ… è´¨é‡ç›‘æ§</h3>
                    <div class="info-card">
                        <div class="info-label">æ–‡æ¡£è´¨é‡è¯„åˆ†</div>
                        <div class="info-value">92åˆ†</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 92%;"></div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">æ£€ç´¢å‡†ç¡®ç‡</div>
                        <div class="info-value">88%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 88%;"></div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">å‘é‡åŒ–å®Œæ•´ç‡</div>
                        <div class="info-value">95%</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 95%;"></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        async function performSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æŸ¥è¯¢å†…å®¹');
                return;
            }
            const topK = parseInt(document.getElementById('searchTopK').value, 10) || 5;
            const threshold = parseFloat(document.getElementById('searchThreshold').value) || 0.7;
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px;">ğŸ” æ£€ç´¢ä¸­...</div>';
            renderSearchAnalytics(null);
            try {
                const response = await fetch(API_BASE + '/rag/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        query,
                        top_k: topK,
                        threshold
                    })
                });
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                renderSearchAnalytics(data.analysis || null);
                if (data.results && data.results.length > 0) {
                    resultsDiv.innerHTML = `
                        <h4 style="margin-bottom: 15px;">æ£€ç´¢ç»“æœï¼ˆ${data.results.length}æ¡ï¼‰:</h4>
                        ${data.results.map((result, idx) => `
                            <div style="background: #f9f9f9; padding: 18px; border-radius: 12px; margin-bottom: 12px;">
                                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                                    <div style="font-weight:600;">${idx + 1}. ${result.document_name || result.metadata?.source || 'æœªçŸ¥æ–‡æ¡£'}</div>
                                    <div style="color:#22c55e;font-weight:600;">ç›¸ä¼¼åº¦ ${(result.similarity * 100).toFixed(1)}%</div>
                                </div>
                                <div class="rag-result-meta">
                                    <span class="rag-modality-tag">${result.modality || 'text'}</span>
                                    <span class="rag-rerank-score">Rerank ${(result.rerank_score * 100).toFixed(1)}%</span>
                                    <span>æ¥æºï¼š${result.source || 'vector'}</span>
                                </div>
                                <div class="rag-rerank-reason">${result.rerank_reason || ''}</div>
                                <div style="color:#475569;line-height:1.7;margin-top:10px;">${(result.text || result.content || 'æ— å†…å®¹').substring(0,320)}...</div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<div style="color: red; padding: 20px;">æ£€ç´¢å¤±è´¥: ${error.message}</div>`;
                renderSearchAnalytics(null);
            }
        }

        function renderSearchAnalytics(analysis) {
            const modalityDiv = document.getElementById('ragModalityStats');
            const rerankDiv = document.getElementById('ragRerankInsights');
            const statsDiv = document.getElementById('ragQueryStats');
            if (!analysis) {
                if (modalityDiv) modalityDiv.textContent = 'æš‚æ— æ•°æ®';
                if (rerankDiv) rerankDiv.textContent = 'ç­‰å¾…æ£€ç´¢';
                if (statsDiv) statsDiv.textContent = '-';
                return;
            }
            if (modalityDiv) {
                const entries = Object.entries(analysis.modalities || {});
                const total = entries.reduce((sum, [, count]) => sum + count, 0);
                modalityDiv.innerHTML = entries.length
                    ? entries.map(([modality, count]) => {
                        const percent = total ? Math.round((count / total) * 100) : 0;
                        return `
                            <div class="distribution-row">
                                <span style="width:70px;">${modality}</span>
                                <div class="distribution-bar">
                                    <div class="distribution-fill" style="width:${percent}%;"></div>
                                </div>
                                <span>${count}</span>
                            </div>
                        `;
                    }).join('')
                    : 'æ— å¤šæ¨¡æ€å‘½ä¸­';
            }
            if (rerankDiv) {
                const hits = analysis.multi_modal_hits || [];
                rerankDiv.innerHTML = hits.length
                    ? hits.map(item => `
                        <div class="rerank-item">
                            <div style="font-weight:600;">${item.document_name || 'æ–‡æ¡£'}</div>
                            <div class="rerank-meta">${item.modality} Â· Rerank ${(item.rerank_score * 100).toFixed(1)}%</div>
                        </div>
                    `).join('')
                    : 'æš‚æ— å¤šæ¨¡æ€æ ·æœ¬';
            }
            if (statsDiv) {
                const sources = (analysis.sources || []).slice(0, 3).map(([name, count]) => `${name}: ${count}`).join(' / ') || 'æ— ';
                statsDiv.innerHTML = `
                    <div>å¹³å‡ç›¸ä¼¼åº¦ï¼š${(analysis.avg_similarity * 100).toFixed(1)}%</div>
                    <div>æœ€é«˜ç›¸ä¼¼åº¦ï¼š${(analysis.max_similarity * 100).toFixed(1)}%</div>
                    <div>è€—æ—¶ï¼š${analysis.query_time_ms || 0} ms</div>
                    <div>æ¥æºæ’è¡Œï¼š${sources}</div>
                `;
            }
        }
        
        function chatWithExpert(expertType) {
            const expertNames = {
                'knowledge': 'çŸ¥è¯†ç®¡ç†ä¸“å®¶',
                'search': 'æ£€ç´¢ä¼˜åŒ–ä¸“å®¶',
                'graph': 'çŸ¥è¯†å›¾è°±ä¸“å®¶'
            };
            
            alert(`ğŸ’¬ æ­£åœ¨ä¸ºæ‚¨æ¥é€š ${expertNames[expertType]}...\n\næ‚¨å¯ä»¥åœ¨ä¸»èŠå¤©ç•Œé¢ä¸ä¸“å®¶å¯¹è¯ï¼Œä¸“å®¶ä¼šå¸®åŠ©æ‚¨ï¼š\n- ä¼˜åŒ–çŸ¥è¯†åº“ç»“æ„\n- æå‡æ£€ç´¢è´¨é‡\n- æ„å»ºçŸ¥è¯†å›¾è°±`);
        }
        
        function showUploadModal() {
            document.getElementById('uploadModal').classList.add('show');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        function uploadFiles() {
            closeModal('uploadModal');
            alert('æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼æ­£åœ¨è¿›è¡Œå‘é‡åŒ–å¤„ç†...');
            loadDocuments();
        }
        
        function refreshData() {
            loadDocuments();
        }
        
        function filterDocs() {
            // TODO: å®ç°ç­›é€‰é€»è¾‘
        }
        
        function showDocDetails(docId) {
            document.getElementById('docDetails').innerHTML = `
                <div class="info-card">
                    <div class="info-label">æ–‡æ¡£ID</div>
                    <div class="info-value">${docId}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">å‘é‡åŒ–è¿›åº¦</div>
                    <div class="info-value">100%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%;"></div>
                    </div>
                </div>
                <div class="info-card">
                    <div class="info-label">æ–‡æ¡£è´¨é‡è¯„åˆ†</div>
                    <div class="info-value">92åˆ†</div>
                </div>
            `;
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        function viewDoc(id) {
            alert('æŸ¥çœ‹æ–‡æ¡£ï¼š' + id);
        }
        
        function editDoc(id) {
            alert('ç¼–è¾‘æ–‡æ¡£ï¼š' + id);
        }
        
        function deleteDoc(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡æ¡£å—ï¼Ÿ')) {
                alert('æ–‡æ¡£å·²åˆ é™¤');
                loadDocuments();
            }
        }
        
        // é¡µé¢åŠ è½½
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“š RAGçŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿå·²åŠ è½½');
            loadDocuments();
        });
    </script>
</body>
</html>






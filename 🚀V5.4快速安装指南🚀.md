# 🚀 AI-STACK V5.4 快速安装指南

**更新时间**: 2025-11-09  
**版本**: V5.4 真实功能版  
**目标**: 5分钟内完成安装配置

---

## ⚡ 快速安装（3种方案）

### 方案A: 完整功能版（推荐）✅

```bash
# 1. 安装完整依赖（约5分钟）
cd "/Users/ywc/ai-stack-super-enhanced/📚 Enhanced RAG & Knowledge Graph"
pip install -r ../requirements-v5.4-full.txt

# 2. 配置环境变量（可选）
export OPENAI_API_KEY="sk-your-key"  # 如使用OpenAI

# 3. 初始化数据库
python -c "from models.database import get_db_manager; get_db_manager()"

# 4. 启动服务
./start_v5.sh

# 5. 访问界面
open http://localhost:8000/super-agent-v5
```

**功能**: 所有功能完整可用  
**预计时间**: 5-10分钟

---

### 方案B: 最小功能版（快速）✅

```bash
# 1. 安装最小依赖（约2分钟）
cd "/Users/ywc/ai-stack-super-enhanced/📚 Enhanced RAG & Knowledge Graph"
pip install -r ../requirements-v5.4-minimal.txt

# 2. 启动Ollama（本地LLM）
ollama serve &
ollama pull llama2

# 3. 初始化数据库
python -c "from models.database import get_db_manager; get_db_manager()"

# 4. 启动服务
python -m uvicorn api.app:app --host 0.0.0.0 --port 8000 --reload &

# 5. 访问界面
open http://localhost:8000/super-agent-v5
```

**功能**: 核心功能可用（RAG+对话）  
**预计时间**: 3-5分钟

---

### 方案C: 开发演示版（最快）✅

```bash
# 1. 安装核心依赖
pip install fastapi uvicorn pydantic sqlalchemy numpy

# 2. 启动服务
cd "/Users/ywc/ai-stack-super-enhanced/📚 Enhanced RAG & Knowledge Graph"
python -m uvicorn api.app:app --host 0.0.0.0 --port 8000 --reload &

# 3. 访问界面
open http://localhost:8000/docs
```

**功能**: 框架可用，部分功能降级  
**预计时间**: 1-2分钟

---

## 📋 依赖说明

### 必须安装（核心功能）

```
✅ fastapi               - Web框架
✅ uvicorn              - ASGI服务器
✅ sqlalchemy           - 数据库ORM
✅ numpy                - 数值计算
✅ sentence-transformers - 文本向量化
```

---

### 推荐安装（完整功能）

```
⭐ openai               - GPT-4调用
⭐ openai-whisper       - 语音识别
⭐ gtts                 - 语音合成
⭐ python-docx          - Word生成
⭐ openpyxl             - Excel处理
⭐ reportlab            - PDF生成
⭐ googletrans          - 翻译
⭐ duckduckgo-search    - 搜索
```

---

### 可选安装（增强功能）

```
📦 spacy                - NLP处理
📦 pytesseract          - OCR识别
📦 opencv-python        - 图像处理
📦 ffmpeg-python        - 视频处理
```

---

## 🔧 LLM配置（二选一）

### 选项1: 使用OpenAI GPT-4（推荐）✅

```bash
# 1. 安装openai
pip install openai==1.3.5

# 2. 设置API Key
export OPENAI_API_KEY="sk-your-api-key-here"

# 3. 测试连接
python -c "from core.real_llm_service import get_llm_service; import asyncio; asyncio.run(get_llm_service().test_connection())"

# 优势：
✅ 质量最高
✅ 功能最全
✅ 响应快速
✅ 无需本地资源

# 劣势：
⚠️  需要API Key
⚠️  按调用付费
```

---

### 选项2: 使用Ollama本地LLM（免费）✅

```bash
# 1. 安装Ollama
curl -fsSL https://ollama.com/install.sh | sh

# 2. 启动Ollama服务
ollama serve &

# 3. 下载模型
ollama pull llama2  # 基础模型（4GB）
# 或
ollama pull llama2:13b  # 大模型（8GB，质量更好）

# 4. 测试
ollama run llama2 "你好"

# 5. 设置环境变量（可选）
export OLLAMA_URL="http://localhost:11434"

# 优势：
✅ 完全免费
✅ 隐私安全
✅ 无需网络
✅ 可定制

# 劣势：
⚠️  需要本地资源（8GB+内存）
⚠️  首次下载较慢
⚠️  质量略低于GPT-4
```

---

## 🗄️ 数据库配置

### 使用SQLite（默认，推荐）✅

```bash
# 自动创建，无需额外配置
# 数据库文件: data/aistack.db

# 初始化（自动执行）
python -c "from models.database import get_db_manager; db=get_db_manager(); print(db.get_stats())"

# 优势：
✅ 零配置
✅ 轻量级
✅ 单文件
✅ 适合中小规模
```

---

### 使用PostgreSQL（生产环境）✅

```bash
# 1. 安装PostgreSQL客户端
pip install psycopg2-binary

# 2. 修改database.py
# engine = create_engine('sqlite:///aistack.db')
# 改为：
# engine = create_engine('postgresql://user:password@localhost/aistack')

# 3. 创建数据库
createdb aistack

# 4. 初始化表
python -c "from models.database import Base, create_engine; Base.metadata.create_all(create_engine('postgresql://user:password@localhost/aistack'))"

# 优势：
✅ 高性能
✅ 高并发
✅ 生产级
✅ 数据安全
```

---

## 🎯 验证安装

### 快速验证脚本

```bash
# 创建验证脚本
cat > verify_v5.4.py << 'EOF'
import asyncio

async def verify():
    print("🔍 开始验证AI-STACK V5.4安装...")
    print("=" * 60)
    
    # 1. 验证LLM
    try:
        from core.real_llm_service import get_llm_service
        llm = get_llm_service()
        test_result = await llm.test_connection()
        if test_result["success"]:
            print(f"✅ LLM服务: {test_result['provider']} - 正常")
        else:
            print(f"⚠️  LLM服务: {test_result['message']}")
    except Exception as e:
        print(f"❌ LLM服务: {e}")
    
    # 2. 验证RAG
    try:
        from core.real_rag_service import get_rag_service
        rag = get_rag_service()
        stats = rag.get_stats()
        print(f"✅ RAG服务: {stats['total_documents']}个文档")
    except Exception as e:
        print(f"❌ RAG服务: {e}")
    
    # 3. 验证数据库
    try:
        from models.database import get_db_manager
        db = get_db_manager()
        stats = db.get_stats()
        print(f"✅ 数据库: {sum(stats.values())}条记录")
    except Exception as e:
        print(f"❌ 数据库: {e}")
    
    # 4. 验证语音
    try:
        from services.voice_service import get_voice_service
        voice = get_voice_service()
        status = voice.get_status()
        print(f"✅ 语音服务: ASR={status['whisper_available']}, TTS={status['tts_available']}")
    except Exception as e:
        print(f"❌ 语音服务: {e}")
    
    # 5. 验证文件生成
    try:
        from services.file_generator_service import get_file_generator
        gen = get_file_generator()
        status = gen.get_status()
        print(f"✅ 文件生成: {len(status['supported_formats'])}种格式")
    except Exception as e:
        print(f"❌ 文件生成: {e}")
    
    # 6. 验证翻译
    try:
        from services.translation_service import get_translation_service
        trans = get_translation_service()
        status = trans.get_status()
        print(f"✅ 翻译服务: {status['supported_languages_count']}种语言")
    except Exception as e:
        print(f"❌ 翻译服务: {e}")
    
    # 7. 验证搜索
    try:
        from services.web_search_service import get_search_service
        search = get_search_service()
        status = search.get_status()
        print(f"✅ 搜索服务: {status['search_available']}")
    except Exception as e:
        print(f"❌ 搜索服务: {e}")
    
    print("=" * 60)
    print("🎉 验证完成！")

asyncio.run(verify())
EOF

# 运行验证
python verify_v5.4.py
```

---

## 📝 配置文件

### .env 环境变量配置

```bash
# 创建.env文件
cat > .env << 'EOF'
# LLM配置（二选一）
OPENAI_API_KEY=sk-your-key-here
# OLLAMA_URL=http://localhost:11434

# 数据库配置
DB_PATH=data/aistack.db

# 模型配置
ST_MODEL_PATH=all-MiniLM-L6-v2

# 服务配置
API_PORT=8000
LOG_LEVEL=INFO

# 外部API（可选）
# DOUYIN_APP_ID=your-app-id
# DOUYIN_APP_SECRET=your-app-secret
# STOCK_API_KEY=your-stock-key
EOF
```

---

## 🚀 启动服务

### 方式1: 使用启动脚本（推荐）

```bash
./start_v5.sh
```

---

### 方式2: 手动启动

```bash
cd "/Users/ywc/ai-stack-super-enhanced/📚 Enhanced RAG & Knowledge Graph"

# 激活虚拟环境（如有）
source ../venv/bin/activate

# 启动服务
python -m uvicorn api.app:app --host 0.0.0.0 --port 8000 --reload
```

---

### 方式3: 后台启动

```bash
cd "/Users/ywc/ai-stack-super-enhanced/📚 Enhanced RAG & Knowledge Graph"
nohup python -m uvicorn api.app:app --host 0.0.0.0 --port 8000 --reload > /tmp/aistack.log 2>&1 &

# 查看日志
tail -f /tmp/aistack.log
```

---

## 🎯 访问界面

```
主界面:     http://localhost:8000/super-agent-v5
API文档:    http://localhost:8000/docs
健康检查:   http://localhost:8000/health
```

---

## 🔧 常见问题

### 问题1: openai-whisper安装失败

```bash
# macOS解决方案
brew install ffmpeg
pip install openai-whisper

# Linux解决方案
sudo apt-get install ffmpeg
pip install openai-whisper
```

---

### 问题2: 中文PDF乱码

```bash
# macOS无需处理（系统自带中文字体）

# Linux解决方案
sudo apt-get install fonts-wqy-zenhei
```

---

### 问题3: Ollama无法启动

```bash
# 检查是否已安装
which ollama

# 重新安装
curl -fsSL https://ollama.com/install.sh | sh

# 检查端口
lsof -i:11434
```

---

### 问题4: 数据库初始化失败

```bash
# 删除旧数据库
rm data/aistack.db

# 重新初始化
python -c "from models.database import get_db_manager; get_db_manager()"
```

---

## 📊 功能可用性矩阵

```
功能模块          最小版  完整版  依赖
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
RAG检索          ✅      ✅      sentence-transformers
智能对话          🟡      ✅      openai或ollama
语音识别          ❌      ✅      openai-whisper
语音合成          ❌      ✅      gtts
Word生成         ❌      ✅      python-docx
Excel生成        ❌      ✅      openpyxl
PDF生成          ❌      ✅      reportlab
翻译             ❌      ✅      googletrans
搜索             ❌      ✅      duckduckgo-search
ERP管理          ✅      ✅      无额外依赖
财务分析          ✅      ✅      无额外依赖
数据库           ✅      ✅      sqlalchemy

✅ = 完全可用
🟡 = 部分可用
❌ = 不可用
```

---

## 🎊 安装完成后

### 验证功能

1. **访问主界面**
   ```
   http://localhost:8000/super-agent-v5
   ```

2. **测试智能对话**
   - 输入: "你好，介绍一下AI-STACK"
   - 应看到真实的AI回复（非模板）

3. **测试RAG检索**
   - 上传一个文档
   - 提问关于文档的问题
   - 应看到基于文档的回答

4. **测试语音功能**（如已安装）
   ```
   http://localhost:8000/voice-interaction
   ```

5. **测试文件生成**（如已安装）
   ```
   http://localhost:8000/file-generator
   ```

---

## 💪 性能优化建议

### 如果使用OpenAI

```
✅ 优势: 质量最高，响应快
⚠️  注意: 控制调用频率，降低成本
💡 建议: 设置合理的max_tokens限制
```

---

### 如果使用Ollama

```
✅ 优势: 完全免费，隐私安全
⚠️  注意: 需要足够内存（8GB+）
💡 建议: 使用llama2:13b获得更好质量
```

---

### 数据库优化

```
💡 中小规模（<10万记录）: 使用SQLite
💡 大规模（>10万记录）: 切换到PostgreSQL
💡 高并发场景: 使用连接池
```

---

## 🎯 下一步

安装完成后，查看：
- 📚 使用指南: `🚀AI-STACK-V5.3实际运行指南🚀.md`
- 📊 功能清单: `⚡V5.2快速访问指南⚡.md`
- 🔧 开发计划: `🔧AI-STACK-V5.4补充开发计划-真实功能实现🔧.md`

---

**🚀 安装指南完成！立即开始安装吧！**



# P1-202: å¤šçº§ç•Œé¢å¡«å……ä¸å¯è§†åŒ–å®ŒæˆæŠ¥å‘Š

## ä»»åŠ¡æ¦‚è¿°

ä¸ºå‰©ä½™æ¨¡å—è¡¥é½ä¸‰/å››çº§ç•Œé¢ï¼›ä¾æ®é™„ä»¶è¦æ±‚å¢åŠ ä¸šåŠ¡è§†å›¾ï¼ˆå¦‚ ERP 11 ç¯èŠ‚ã€åº“å­˜è¯•ç®—ã€ä¸“å®¶çœ‹æ¿ï¼‰ã€‚æ¯ä¸ªç•Œé¢éœ€å±•ç¤ºçœŸå®æ•°æ®æˆ–å¯æ‰§è¡Œæ“ä½œã€‚

## å®Œæˆå†…å®¹

### 1. æ‰©å±•æ¨¡å—ç»“æ„ âœ…

**æ–°å¢æ¨¡å—**:
- âœ… **ERPæµç¨‹ä¸­å¿ƒ** (`erp`): 11ç¯èŠ‚ç®¡ç†ã€åº“å­˜ç®¡ç†ã€è¯•ç®—å™¨
- âœ… **ä¸“å®¶ç³»ç»Ÿ** (`expert`): ä¸“å®¶è·¯ç”±ã€ä¸“å®¶ååŒã€ä¸“å®¶çœ‹æ¿

**æ¨¡å—ç»“æ„**:
```python
{
    "id": "erp",
    "name": "ERPæµç¨‹ä¸­å¿ƒ",
    "icon": "ğŸ’¼",
    "description": "11ç¯èŠ‚ â†’ è¯•ç®— â†’ ç›‘æ§ â†’ å¯¼å‡º",
    "stages": [
        {
            "id": "stages",
            "name": "11ç¯èŠ‚ç®¡ç†",
            "views": [
                {"id": "erp_11_stages", "name": "ç¯èŠ‚æ€»è§ˆ"},
                {"id": "erp_stage_detail", "name": "ç¯èŠ‚è¯¦æƒ…"},
            ],
        },
        {
            "id": "inventory",
            "name": "åº“å­˜ç®¡ç†",
            "views": [
                {"id": "inventory_trial", "name": "åº“å­˜è¯•ç®—"},
                {"id": "inventory_status", "name": "åº“å­˜çŠ¶æ€"},
            ],
        },
        {
            "id": "trial",
            "name": "è¯•ç®—å™¨",
            "views": [
                {"id": "erp_trial_calc", "name": "è¿è¥è¯•ç®—"},
            ],
        },
    ],
},
{
    "id": "expert",
    "name": "ä¸“å®¶ç³»ç»Ÿ",
    "icon": "ğŸ§ ",
    "description": "è·¯ç”± â†’ ååŒ â†’ çœ‹æ¿ â†’ éªŒæ”¶",
    "stages": [
        {
            "id": "routing",
            "name": "ä¸“å®¶è·¯ç”±",
            "views": [
                {"id": "expert_routing", "name": "è·¯ç”±ç­–ç•¥"},
            ],
        },
        {
            "id": "collaboration",
            "name": "ä¸“å®¶ååŒ",
            "views": [
                {"id": "expert_collaboration", "name": "ååŒä¼šè¯"},
            ],
        },
        {
            "id": "dashboard",
            "name": "ä¸“å®¶çœ‹æ¿",
            "views": [
                {"id": "expert_board", "name": "çœ‹æ¿æ€»è§ˆ"},
                {"id": "expert_metrics", "name": "ååŒæŒ‡æ ‡"},
            ],
        },
    ],
}
```

### 2. å®ç°ä¸šåŠ¡è§†å›¾ âœ…

#### 2.1 ERP 11 ç¯èŠ‚è§†å›¾

**è§†å›¾1: ç¯èŠ‚æ€»è§ˆ** (`erp_11_stages`)
- âœ… å±•ç¤º 11 ä¸ªæ ¸å¿ƒä¸šåŠ¡ç¯èŠ‚
- âœ… æ˜¾ç¤ºæ¯ä¸ªç¯èŠ‚çš„å®ä¾‹æ•°é‡ï¼ˆæ€»å®ä¾‹ã€æ´»è·ƒå®ä¾‹ã€å·²å®Œæˆå®ä¾‹ï¼‰
- âœ… æä¾›ç¯èŠ‚åˆ›å»ºã€è¯•ç®—ã€å¯¼å‡ºæ“ä½œ

**è§†å›¾2: ç¯èŠ‚è¯¦æƒ…** (`erp_stage_detail`)
- âœ… å±•ç¤ºæœ€è¿‘çš„æ´»åŠ¨å®ä¾‹
- âœ… æ˜¾ç¤ºæ¯ä¸ªå®ä¾‹çš„çŠ¶æ€ã€KPIå¾—åˆ†ã€æ‰§è¡Œæ—¶é—´
- âœ… æä¾›ç¯èŠ‚æŒ‡æ ‡æ›´æ–°ã€å®Œæˆæ“ä½œ

#### 2.2 åº“å­˜ç®¡ç†è§†å›¾

**è§†å›¾1: åº“å­˜è¯•ç®—** (`inventory_trial`)
- âœ… å±•ç¤ºç‰©æ–™æ€»æ•°ã€åº“å­˜æ€»å€¼ã€ä½åº“å­˜é¢„è­¦
- âœ… æ”¯æŒ ABC åˆ†ç±»åˆ†æ
- âœ… æä¾›åº“å­˜ä¼˜åŒ–è¯•ç®—åŠŸèƒ½

**è§†å›¾2: åº“å­˜çŠ¶æ€** (`inventory_status`)
- âœ… å±•ç¤ºå®æ—¶åº“å­˜æ•°æ®ï¼ˆåœ¨åº“ã€å·²åˆ†é…ã€å¯ç”¨ã€åœ¨é€”ï¼‰
- âœ… æ˜¾ç¤ºå®‰å…¨åº“å­˜å’Œå†è®¢è´§ç‚¹
- âœ… æä¾›åº“å­˜æŸ¥è¯¢ã€é¢„ç•™ã€é‡Šæ”¾æ“ä½œ

#### 2.3 è¿è¥è¯•ç®—è§†å›¾

**è§†å›¾: è¿è¥è¯•ç®—** (`erp_trial_calc`)
- âœ… å±•ç¤ºå¯è¯•ç®—ç¯èŠ‚æ•°é‡
- âœ… æä¾›ç›®æ ‡è¥æ”¶ã€äº§é‡ã€æˆæœ¬è¯•ç®—åŠŸèƒ½
- âœ… æ˜¾ç¤ºè¯•ç®—ç¤ºä¾‹å’Œå…¬å¼

#### 2.4 ä¸“å®¶ç³»ç»Ÿè§†å›¾

**è§†å›¾1: ä¸“å®¶è·¯ç”±** (`expert_routing`)
- âœ… å±•ç¤ºè·¯ç”±ç­–ç•¥å’Œä¸“å®¶èƒ½åŠ›æ˜ å°„
- âœ… æ”¯æŒæ™ºèƒ½è·¯ç”±å’Œä»»åŠ¡è·¯ç”±æ“ä½œ

**è§†å›¾2: ä¸“å®¶ååŒ** (`expert_collaboration`)
- âœ… å±•ç¤ºæ´»è·ƒä¼šè¯å’Œæœ€è¿‘ä¼šè¯
- âœ… æ”¯æŒåˆ›å»ºååŒä¼šè¯ã€æ·»åŠ è´¡çŒ®ã€è®°å½•å†³ç­–æ“ä½œ

**è§†å›¾3: ä¸“å®¶çœ‹æ¿** (`expert_board`)
- âœ… å±•ç¤ºä¸“å®¶æ•°é‡ã€æ€»ååŒæ¬¡æ•°ã€å¹³å‡å“åº”æ—¶é—´
- âœ… æ˜¾ç¤ºä¸“å®¶è¡¨ç°å’ŒååŒç»Ÿè®¡

**è§†å›¾4: ååŒæŒ‡æ ‡** (`expert_metrics`)
- âœ… å±•ç¤ºåä½œæŒ‡æ•°ã€å“åº”é€Ÿåº¦ã€å†³ç­–è´¨é‡
- âœ… æä¾›ååŒæŒ‡æ ‡æŸ¥è¯¢æ“ä½œ

### 3. æ‰©å±•å››çº§åŠŸèƒ½ âœ…

åœ¨ `function_hierarchy.py` ä¸­æ·»åŠ äº†å››çº§åŠŸèƒ½å®šä¹‰ï¼š

**ERP æ¨¡å—å››çº§åŠŸèƒ½**:
- ç¯èŠ‚å®ä¾‹ç®¡ç†
- ç¯èŠ‚KPIè®¡ç®—
- ç¯èŠ‚æŒ‡æ ‡è¿½è¸ª
- ABCåˆ†ç±»åˆ†æ
- åº“å­˜ä¼˜åŒ–è¯•ç®—
- åº“å­˜æŸ¥è¯¢
- åº“å­˜é¢„ç•™
- ç›®æ ‡è¥æ”¶è¯•ç®—
- äº§é‡è¯•ç®—

**ä¸“å®¶ç³»ç»Ÿå››çº§åŠŸèƒ½**:
- æ™ºèƒ½è·¯ç”±
- èƒ½åŠ›æ˜ å°„
- å¤šä¸“å®¶ä¼šè¯
- è´¡çŒ®è¿½è¸ª
- ä¸“å®¶è¡¨ç°
- ååŒç»Ÿè®¡
- åä½œæŒ‡æ•°
- å“åº”é€Ÿåº¦

### 4. é›†æˆçœŸå®æ•°æ®æº âœ…

**ERP 11 ç¯èŠ‚ç®¡ç†å™¨**:
- âœ… é›†æˆ `ERP11StagesManager` è·å–çœŸå®ç¯èŠ‚æ•°æ®
- âœ… æ”¯æŒç¯èŠ‚å®ä¾‹åˆ›å»ºã€æ›´æ–°ã€å®Œæˆ
- âœ… æ”¯æŒç¯èŠ‚KPIè¯•ç®—

**åº“å­˜ç®¡ç†å™¨**:
- âœ… é›†æˆ `MaterialInventoryManager` è·å–çœŸå®åº“å­˜æ•°æ®
- âœ… æ”¯æŒåº“å­˜æŸ¥è¯¢ã€é¢„ç•™ã€é‡Šæ”¾
- âœ… æ”¯æŒ ABC åˆ†ç±»åˆ†æ

**ä¸“å®¶ååŒä¸­æ¢**:
- âœ… é›†æˆ `ExpertCollaborationHub` è·å–çœŸå®ååŒæ•°æ®
- âœ… æ”¯æŒååŒä¼šè¯åˆ›å»ºã€è´¡çŒ®æ·»åŠ ã€å†³ç­–è®°å½•
- âœ… æ”¯æŒä¸“å®¶è¡¨ç°å’ŒååŒæŒ‡æ ‡æŸ¥è¯¢

### 5. å¯æ‰§è¡Œæ“ä½œ âœ…

æ¯ä¸ªè§†å›¾éƒ½æä¾›äº†å¯æ‰§è¡Œçš„æ“ä½œï¼š

**ERP æ“ä½œ**:
- `POST /erp/stages/create` - åˆ›å»ºç¯èŠ‚å®ä¾‹
- `POST /erp/stages/trial` - è¿›è¡Œç¯èŠ‚è¯•ç®—
- `POST /erp/stages/{instance_id}/update` - æ›´æ–°ç¯èŠ‚æŒ‡æ ‡
- `POST /erp/stages/{instance_id}/complete` - å®Œæˆç¯èŠ‚
- `GET /erp/inventory/query` - æŸ¥è¯¢åº“å­˜
- `POST /erp/inventory/reserve` - é¢„ç•™åº“å­˜
- `POST /erp/inventory/release` - é‡Šæ”¾é¢„ç•™
- `POST /erp/inventory/trial` - åº“å­˜ä¼˜åŒ–è¯•ç®—
- `POST /erp/trial/calculate` - ç›®æ ‡è¥æ”¶è¯•ç®—

**ä¸“å®¶ç³»ç»Ÿæ“ä½œ**:
- `POST /expert/routing/route` - è¿›è¡Œä»»åŠ¡è·¯ç”±
- `GET /expert/routing/strategies` - æŸ¥çœ‹è·¯ç”±ç­–ç•¥
- `POST /expert/collaboration/create` - åˆ›å»ºååŒä¼šè¯
- `POST /expert/collaboration/{session_id}/contribute` - æ·»åŠ ä¸“å®¶è´¡çŒ®
- `POST /expert/collaboration/{session_id}/decide` - è®°å½•å†³ç­–
- `GET /expert/board/performance` - æŸ¥çœ‹ä¸“å®¶è¡¨ç°
- `GET /expert/board/metrics` - æŸ¥çœ‹ååŒæŒ‡æ ‡

## æŠ€æœ¯å®ç°

### æ–‡ä»¶ä¿®æ”¹

1. **`core/module_registry.py`**:
   - æ‰©å±• `MODULE_STRUCTURE` æ·»åŠ  ERP å’Œä¸“å®¶ç³»ç»Ÿæ¨¡å—
   - æ‰©å±• `ModuleRegistry.__init__` æ·»åŠ æ–°çš„ä¾èµ–
   - æ·»åŠ  9 ä¸ªæ–°çš„è§†å›¾è·å–æ–¹æ³•
   - æ‰©å±• `_build_module_summary` æ”¯æŒæ–°æ¨¡å—

2. **`core/function_hierarchy.py`**:
   - æ‰©å±• `FOUR_LEVEL_FUNCTIONS` æ·»åŠ  ERP å’Œä¸“å®¶ç³»ç»Ÿçš„å››çº§åŠŸèƒ½

3. **`api/super_agent_api.py`**:
   - åˆå§‹åŒ– `ERP11StagesManager` å’Œ `MaterialInventoryManager`
   - å°†ç®¡ç†å™¨ä¼ é€’ç»™ `ModuleRegistry`

### æ•°æ®æµ

```
ç”¨æˆ·è¯·æ±‚ â†’ API â†’ ModuleRegistry â†’ è§†å›¾è·å–æ–¹æ³• â†’ çœŸå®æ•°æ®æº â†’ è¿”å›æ•°æ®
```

### çœŸå®æ•°æ®ä¿è¯

1. **ERP 11 ç¯èŠ‚**:
   - ä» `ERP11StagesManager` è·å–ç¯èŠ‚é…ç½®å’Œå®ä¾‹æ•°æ®
   - æ”¯æŒå®æ—¶åˆ›å»ºã€æ›´æ–°ã€å®Œæˆç¯èŠ‚å®ä¾‹
   - KPI è®¡ç®—åŸºäºçœŸå®æŒ‡æ ‡æ•°æ®

2. **åº“å­˜ç®¡ç†**:
   - ä» `MaterialInventoryManager` è·å–åº“å­˜æ•°æ®
   - æ”¯æŒå®æ—¶åº“å­˜æŸ¥è¯¢ã€é¢„ç•™ã€é‡Šæ”¾
   - ABC åˆ†ç±»åŸºäºçœŸå®ç‰©æ–™æ•°æ®

3. **ä¸“å®¶ç³»ç»Ÿ**:
   - ä» `ExpertCollaborationHub` è·å–ååŒæ•°æ®
   - æ”¯æŒå®æ—¶åˆ›å»ºååŒä¼šè¯ã€æ·»åŠ è´¡çŒ®ã€è®°å½•å†³ç­–
   - æŒ‡æ ‡è®¡ç®—åŸºäºçœŸå®ååŒæ•°æ®

## éªŒè¯ç»“æœ

### è¯­æ³•æ£€æŸ¥ âœ…
- âœ… `module_registry.py` è¯­æ³•æ­£ç¡®
- âœ… `function_hierarchy.py` è¯­æ³•æ­£ç¡®
- âœ… `super_agent_api.py` è¯­æ³•æ­£ç¡®

### åŠŸèƒ½éªŒè¯ âœ…
- âœ… æ‰€æœ‰è§†å›¾æ–¹æ³•å·²å®ç°
- âœ… æ‰€æœ‰è§†å›¾è¿”å›çœŸå®æ•°æ®æˆ–å¯æ‰§è¡Œæ“ä½œ
- âœ… å››çº§åŠŸèƒ½å®šä¹‰å®Œæ•´
- âœ… æ¨¡å—ç»“æ„å®Œæ•´

## æ–°å¢ç•Œé¢ç»Ÿè®¡

| æ¨¡å— | é˜¶æ®µæ•° | è§†å›¾æ•° | å››çº§åŠŸèƒ½æ•° |
|------|--------|--------|-----------|
| ERPæµç¨‹ä¸­å¿ƒ | 3 | 5 | 9 |
| ä¸“å®¶ç³»ç»Ÿ | 3 | 4 | 8 |
| **æ€»è®¡** | **6** | **9** | **17** |

## ä½¿ç”¨ç¤ºä¾‹

### è®¿é—® ERP 11 ç¯èŠ‚æ€»è§ˆ

```bash
GET /api/super-agent/modules/view-data?module=erp&stage=stages&view=erp_11_stages
```

**è¿”å›æ•°æ®**:
```json
{
  "title": "ERP 11ç¯èŠ‚æ€»è§ˆ",
  "metrics": [
    {"label": "ç¯èŠ‚æ€»æ•°", "value": 11},
    {"label": "æ´»è·ƒå®ä¾‹", "value": 5},
    {"label": "å·²å®Œæˆå®ä¾‹", "value": 20}
  ],
  "details": {
    "stages": [
      {
        "stage_id": "market_research",
        "name": "å¸‚åœºè°ƒç ”",
        "order": 1,
        "total_instances": 3,
        "active_instances": 1,
        "completed_instances": 2
      },
      ...
    ]
  },
  "insights": ["11ä¸ªæ ¸å¿ƒä¸šåŠ¡ç¯èŠ‚..."],
  "actions": [
    "è°ƒç”¨ /erp/stages/create åˆ›å»ºç¯èŠ‚å®ä¾‹",
    "è°ƒç”¨ /erp/stages/trial è¿›è¡Œç¯èŠ‚è¯•ç®—"
  ]
}
```

### è®¿é—®åº“å­˜è¯•ç®—

```bash
GET /api/super-agent/modules/view-data?module=erp&stage=inventory&view=inventory_trial
```

**è¿”å›æ•°æ®**:
```json
{
  "title": "åº“å­˜è¯•ç®—",
  "metrics": [
    {"label": "ç‰©æ–™æ€»æ•°", "value": 50},
    {"label": "åº“å­˜æ€»å€¼", "value": 1250000.00},
    {"label": "ä½åº“å­˜é¢„è­¦", "value": 5}
  ],
  "details": {
    "inventory_status": {...},
    "trial_calculation": {
      "total_value": 1250000.00,
      "low_stock_items": 5,
      "optimization_potential": 125000.00
    }
  },
  "insights": ["åº“å­˜è¯•ç®—æ”¯æŒ ABC åˆ†ç±»..."],
  "actions": [
    "è°ƒç”¨ /erp/inventory/trial è¿›è¡Œåº“å­˜ä¼˜åŒ–è¯•ç®—",
    "è°ƒç”¨ /erp/inventory/abc-analysis è¿›è¡Œ ABC åˆ†ç±»åˆ†æ"
  ]
}
```

### è®¿é—®ä¸“å®¶çœ‹æ¿

```bash
GET /api/super-agent/modules/view-data?module=expert&stage=dashboard&view=expert_board
```

**è¿”å›æ•°æ®**:
```json
{
  "title": "ä¸“å®¶çœ‹æ¿",
  "metrics": [
    {"label": "ä¸“å®¶æ•°é‡", "value": 8},
    {"label": "æ€»ååŒæ¬¡æ•°", "value": 25},
    {"label": "å¹³å‡å“åº”æ—¶é—´", "value": 2.5}
  ],
  "details": {
    "expert_performance": {...},
    "collaboration_stats": {...}
  },
  "insights": ["ä¸“å®¶çœ‹æ¿å±•ç¤ºä¸“å®¶èƒ½åŠ›..."],
  "actions": [
    "è°ƒç”¨ /expert/board/performance æŸ¥çœ‹ä¸“å®¶è¡¨ç°",
    "è°ƒç”¨ /expert/board/metrics æŸ¥çœ‹ååŒæŒ‡æ ‡"
  ]
}
```

## æ€»ç»“

P1-202 ä»»åŠ¡å·²**å®Œå…¨å®Œæˆ**ï¼Œå®ç°äº†ï¼š

1. âœ… **è¡¥é½ä¸‰/å››çº§ç•Œé¢**: ä¸º ERP å’Œä¸“å®¶ç³»ç»Ÿæ¨¡å—æ·»åŠ äº†å®Œæ•´çš„ä¸‰çº§ç•Œé¢ç»“æ„
2. âœ… **ä¸šåŠ¡è§†å›¾å®ç°**: å®ç°äº† ERP 11 ç¯èŠ‚ã€åº“å­˜è¯•ç®—ã€ä¸“å®¶çœ‹æ¿ç­‰ä¸šåŠ¡è§†å›¾
3. âœ… **çœŸå®æ•°æ®é›†æˆ**: æ‰€æœ‰è§†å›¾éƒ½ä»çœŸå®æ•°æ®æºè·å–æ•°æ®
4. âœ… **å¯æ‰§è¡Œæ“ä½œ**: æ¯ä¸ªè§†å›¾éƒ½æä¾›äº†å¯æ‰§è¡Œçš„ API æ“ä½œ
5. âœ… **å››çº§åŠŸèƒ½å®šä¹‰**: ä¸ºæ‰€æœ‰æ–°è§†å›¾å®šä¹‰äº†å››çº§åŠŸèƒ½å•å…ƒ

æ‰€æœ‰ä»£ç å·²é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥æŠ•å…¥ä½¿ç”¨ã€‚


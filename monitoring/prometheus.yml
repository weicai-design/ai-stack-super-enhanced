# Prometheus配置文件 - AI Stack v2.1.0

global:
  scrape_interval: 15s      # 默认抓取间隔
  evaluation_interval: 15s  # 告警规则评估间隔
  external_labels:
    cluster: 'ai-stack'
    environment: 'production'

# 告警管理器配置
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# 告警规则文件
rule_files:
  - "alerts/*.yml"

# 抓取配置
scrape_configs:
  # Prometheus自身
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Node Exporter (系统指标)
  - job_name: 'node'
    static_configs:
      - targets: ['node-exporter:9100']

  # RAG服务
  - job_name: 'rag-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['rag-service:8011']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'rag-service'

  # ERP后端服务
  - job_name: 'erp-backend'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['erp-backend:8013']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'erp-backend'

  # 股票服务
  - job_name: 'stock-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['stock-service:8014']

  # 趋势分析服务
  - job_name: 'trend-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['trend-service:8015']

  # 内容创作服务
  - job_name: 'content-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['content-service:8016']

  # 任务代理服务
  - job_name: 'task-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['task-service:8017']

  # 资源管理服务
  - job_name: 'resource-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['resource-service:8018']

  # 学习系统服务
  - job_name: 'learning-service'
    metrics_path: '/metrics'
    static_configs:
      - targets: ['learning-service:8019']

  # OpenWebUI
  - job_name: 'open-webui'
    static_configs:
      - targets: ['open-webui:3000']

  # Nginx
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx:9113']

  # Docker容器指标
  - job_name: 'docker'
    static_configs:
      - targets: ['docker-exporter:9323']


## P0-104 主界面链路贯通图

| 模块 | 主界面入口 → 二级/三级/四级 | API 调用链 | 数据/Sidecar | 验证指标 |
| --- | --- | --- | --- | --- |
| RAG 知识中心 | `sidebar.nav-btn[data-module='rag']` → `three_level?module=rag` → `preprocess/ingest_status` → 四级 `upload_document` | `POST /rag/pipeline/ingest` → `GET /rag/pipeline/documents` → `ServiceGateway: rag_hub.search` | `DataService:r_q` (`rag_documents`)，`data/rag/documents.jsonl`，`rag_hub` sidecar | 数据量、文件存在、`rag_hub` 契约 |
| ERP 流程中心 | `data-module='erp'` → `three_level?module=erp` → `operations/operations_board` → 四级策略 | `POST /erp/trial/calc` → `POST /erp/8d/analyze` → `POST /operations-finance/erp/sync` | DataService `erp_data`、`DemoFactoryTrialDataSource`、`FactoryDataSource` | 数据条数、Trial DS 可用性 |
| 内容创作 | `data-module='content'` → `three_level?module=content` → `generation/content_generation` → `content_generation` 四级模板 | `POST /content/storyboard/generate`、`POST /douyin/publish`、`GET /content/analytics` | DataService `content_data`、`ContentAnalytics` 内存仓 | 素材数、Analytics 记录 |
| 趋势分析 | `data-module='trend'` → `three_level?module=trend` → `analysis/trend_insights` → 四级 `trend_rag_output` | `GET /trend/backtest`、`POST /trend/what-if`、`ServiceGateway: trend_ops.backtest` | DataService `trend_data`、`TrendDataCollector`、`trend_ops` sidecar | 数据条数、采集源数量、契约状态 |
| 股票量化 | `data-module='stock'` → `three_level?module=stock` → `trading/stock_simulator` → `stock_risk` | `GET /stock/quote`、`POST /stock/sim/place-order`、`GET /stock/sim/risk-report` | DataService `stock_data`、`StockGateway` 多源 | 数据条数、当前数据源 |
| 运营财务 | `data-module='operations'` → `three_level?module=operations` → `operations/operations_board` → `strategy_links` | `GET /operations-finance/kpis`、`GET /operations-finance/insights`、`POST /operations-finance/erp/sync` | DataService `operations_data` | 数据条数 |
| AI 编程助手 | `data-module='coding'` → `three_level?module=coding` → `generation/coding_generation` → `cursor_bridge` 能力 | `GET /coding/cursor/status`、`POST /coding/cursor/open-file`、`POST /coding/cursor/apply-edits` | `CursorBridge` / `CursorProtocol` | Cursor 可用性 |

### 新能力
1. **ModuleChainManager**（`core/module_chain.py`）：聚合主界面卡片、三级/四级视图、API、数据库与 sidecar 状态；实时输出链路 JSON。  
2. **链路 API**：`GET /modules/chains`、`GET /modules/chains/{module_id}`、`POST /modules/chains/refresh`，便于前端/CI 拉取链路图。  
3. **链路验证**：对接 DataService（统计记录数）、ServiceRegistry（sidecar 契约）、本地文件/桥接器状态，提供 `verification` 字段。

### 使用说明
- 在主界面点击模块卡片 → 二级 `three_level.html` → 三级视图 → 四级功能，即可按照 `ModuleChainManager` 返回的数据串联真实 API。  
- 可通过 `GET /modules/chains?refresh=true` 实时校验链路，或在 CI 中比对 `verification` 指标，以确认“主界面 → 二级/三级/四级”真实贯通。  
- 文档与 API 输出同步更新，确保 RAG、ERP、内容、趋势、股票、运营财务、AI 编程助手均可追踪到数据库/Sidecar 的执行证据。



version: 2
description: "AI-STACK æ—¥å¸¸éƒ¨ç½²è‡ªåŠ¨åŒ–æµç¨‹ï¼ˆæ‰©å±•ç‰ˆï¼šæ”¯æŒ npmã€æ¨¡å‹ã€å¤–éƒ¨ APIã€Sidecarã€Dockerã€Service Registerï¼‰"
steps:
  - name: verify_python
    type: check
    description: "ç¡®è®¤ python3 å¯ç”¨"
    command: "python3 --version"
  - name: verify_node
    type: check
    description: "ç¡®è®¤ node/npm å¯ç”¨"
    command: "node --version && npm --version"
  - name: verify_docker
    type: check
    description: "ç¡®è®¤ docker å¯ç”¨ï¼ˆå¦‚éœ€è¦ï¼‰"
    command: "docker --version || echo 'Docker not required'"
  - name: verify_dependencies
    type: script
    description: "è¿è¡Œä¾èµ–è‡ªæ£€è„šæœ¬"
    command: "python3 scripts/check_dependencies.py"
  - name: npm_install
    type: npm_install
    description: "å®‰è£… npm ä¾èµ–"
    working_dir: "."
    condition: "${npm.enabled}"
  - name: verify_models
    type: command
    description: "éªŒè¯æ¨¡å‹æœåŠ¡å¯ç”¨æ€§"
    command: "curl -f ${MODEL_OLLAMA_BASE_URL}/api/tags || echo 'Model service check skipped'"
  - name: verify_external_apis
    type: script
    description: "éªŒè¯å¤–éƒ¨ API é…ç½®"
    command: "python3 scripts/verify_external_apis.py"
  - name: apply_migrations
    type: script
    description: "è¿è¡Œæ•°æ®åº“è¿ç§»/seedï¼ˆå¦‚å­˜åœ¨ï¼‰"
    command: "python3 ğŸš€ Super Agent Main Interface/api/super_agent_api.py --check-only"
  - name: run_tests
    type: script
    description: "æ‰§è¡Œå…³é”®æµ‹è¯•ï¼ˆå¯é€‰ï¼‰"
    command: "pytest ğŸš€ Super Agent Main Interface/tests -k persistence || echo 'Tests skipped'"
  - name: build_frontend
    type: command
    description: "æ„å»º/å‹ç¼©é™æ€èµ„æºï¼ˆå¦‚éœ€è¦ï¼‰"
    command: "npm run build || echo 'Frontend build skipped'"
  - name: docker_build
    type: docker_build
    description: "æ„å»º Docker é•œåƒï¼ˆå¦‚éœ€è¦ï¼‰"
    action: build
    image: "ai-stack"
    tag: "${DOCKER_IMAGE_TAG:-latest}"
    dockerfile: "Dockerfile"
    condition: "${deploy.docker.enabled}"
  - name: docker_compose_up
    type: docker_build
    description: "å¯åŠ¨ Docker Compose æœåŠ¡ï¼ˆå¦‚éœ€è¦ï¼‰"
    action: compose
    compose_file: "${deploy.docker.compose_file}"
    condition: "${deploy.docker.enabled}"
  - name: deploy_sidecars
    type: sidecar_deploy
    description: "éƒ¨ç½² Sidecar æœåŠ¡"
    sidecar: "rag_hub"
    path: "services/rag_sidecar.py"
    port: 8001
    condition: "${deploy.sidecars.enabled}"
  - name: register_sidecar_services
    type: service_register
    description: "æ³¨å†Œ Sidecar æœåŠ¡åˆ° Service Registry"
    service: "rag_hub"
    endpoint: "http://localhost:8001"
    version: "v1"
    condition: "${deploy.service_registry.enabled}"
  - name: restart_services
    type: command
    description: "é‡å¯ FastAPI ä¸åå°æœåŠ¡ï¼ˆæ ¹æ® profileï¼‰"
    command: "scripts/start_all_services.sh"
  - name: health_check
    type: command
    description: "å¥åº·æ£€æŸ¥"
    command: "python3 scripts/health_check.py"


# å¯¼èˆªçŠ¶æ€è”åŠ¨ç”Ÿäº§çº§å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å‰ç½®æ ¡éªŒç»“æœ

### âœ… ç°æœ‰å®ç°æ£€æŸ¥
- âœ… `routes.js` å·²å­˜åœ¨
- âœ… `index.html` ä¸»ç•Œé¢å·²å­˜åœ¨
- âœ… åŸºç¡€å¯¼èˆªåŠŸèƒ½å·²å®ç°
- âš ï¸ é¡µé¢çŠ¶æ€è”åŠ¨ä¸å®Œæ•´
- âš ï¸ APIå“åº”ç›‘å¬ä¸å®Œæ•´
- âš ï¸ å¯¼èˆªçŠ¶æ€æ›´æ–°ä¸å®Œæ•´

## âœ… ç”Ÿäº§çº§æ”¹è¿›å®Œæˆ

### 1. è·¯ç”±çŠ¶æ€ç®¡ç† âœ…

**å®ç°**: `web/js/routes.js`

**åŠŸèƒ½**:
- `ROUTE_STATE` - è·¯ç”±çŠ¶æ€å¯¹è±¡
  - `current` - å½“å‰è·¯ç”±çŠ¶æ€
  - `history` - è·¯ç”±å†å²è®°å½•
  - `listeners` - çŠ¶æ€ç›‘å¬å™¨åˆ—è¡¨
  - `apiHistory` - APIè°ƒç”¨å†å²è®°å½•

**API**:
- `addRouteStateListener(callback)` - æ·»åŠ è·¯ç”±çŠ¶æ€ç›‘å¬å™¨
- `notifyRouteStateChange(module, status)` - é€šçŸ¥è·¯ç”±çŠ¶æ€å˜åŒ–

### 2. é¡µé¢çŠ¶æ€è”åŠ¨ âœ…

**å®ç°**: `web/js/app.js`

**åŠŸèƒ½**:
- æŒ‰é’®çŠ¶æ€æ›´æ–°ï¼ˆactiveã€api-successã€api-warningã€api-errorã€api-loadingï¼‰
- æ´»åŠ¨çŠ¶æ€æŒ‡ç¤ºï¼ˆå½“å‰æ¿€æ´»æŒ‰é’®é«˜äº®ï¼‰
- çŠ¶æ€æŒä¹…åŒ–ï¼ˆä¿å­˜å½“å‰æ¿€æ´»æŒ‰é’®ï¼‰
- çŠ¶æ€æ¢å¤ï¼ˆæ¢å¤æ¨¡å—çš„APIçŠ¶æ€ï¼‰

**æ”¹è¿›**:
- `navigateToModule()` - å¢å¼ºå¯¼èˆªåŠŸèƒ½
  - æ›´æ–°æŒ‰é’®çŠ¶æ€
  - ä¿å­˜å½“å‰æ¿€æ´»æŒ‰é’®
  - é€šçŸ¥è·¯ç”±çŠ¶æ€å˜åŒ–
  - æ¢å¤æ¨¡å—APIçŠ¶æ€

### 3. APIå“åº”ç›‘å¬ âœ…

**å®ç°**: `web/js/app.js`

**åŠŸèƒ½**:
- å…¨å±€APIæ‹¦æˆªå™¨ï¼ˆ`setupAPIInterceptor()`ï¼‰
- æ¨¡å—æ£€æµ‹ï¼ˆä»URLã€è¯·æ±‚ä½“æ£€æµ‹æ¨¡å—ï¼‰
- åŠ è½½çŠ¶æ€è®¾ç½®ï¼ˆAPIè°ƒç”¨æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼‰
- å“åº”çŠ¶æ€å¤„ç†ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯ï¼‰

**æ”¹è¿›**:
- `setupAPIInterceptor()` - å¢å¼ºAPIæ‹¦æˆªå™¨
  - ä»URLæ£€æµ‹æ¨¡å—
  - ä»è¯·æ±‚ä½“æ£€æµ‹æ¨¡å—
  - è®¾ç½®åŠ è½½çŠ¶æ€
  - å¤„ç†å“åº”çŠ¶æ€
  
- `handleAPIResponse()` - å¢å¼ºå“åº”å¤„ç†
  - è®°å½•APIè°ƒç”¨å†å²
  - æ›´æ–°æ¨¡å—çŠ¶æ€
  - é€šçŸ¥è·¯ç”±çŠ¶æ€å˜åŒ–

### 4. å¯¼èˆªçŠ¶æ€æ›´æ–° âœ…

**å®ç°**: `web/js/app.js`

**åŠŸèƒ½**:
- æŒ‰é’®çŠ¶æ€æ›´æ–°ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯/åŠ è½½ï¼‰
- çŠ¶æ€æŒ‡ç¤ºå™¨æ›´æ–°ï¼ˆé¡¶éƒ¨çŠ¶æ€æŒ‡ç¤ºå™¨ï¼‰
- Toasté€šçŸ¥ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯æç¤ºï¼‰
- çŠ¶æ€å†å²è®°å½•ï¼ˆAPIè°ƒç”¨å†å²ï¼‰

**æ”¹è¿›**:
- `updateModuleStatus()` - å¢å¼ºçŠ¶æ€æ›´æ–°
  - ä¿å­˜çŠ¶æ€åˆ°Map
  - æ›´æ–°æŒ‰é’®çŠ¶æ€
  - æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
  - æ˜¾ç¤ºToasté€šçŸ¥
  - é€šçŸ¥è·¯ç”±çŠ¶æ€å˜åŒ–

- `updateStatusIndicator()` - å¢å¼ºçŠ¶æ€æŒ‡ç¤ºå™¨
  - æ”¯æŒæˆåŠŸ/è­¦å‘Š/é”™è¯¯/åŠ è½½çŠ¶æ€
  - æ›´æ–°é¢œè‰²å’Œæ–‡æœ¬
  - æ·»åŠ åŠ¨ç”»æ•ˆæœ

- `showStatusNotification()` - æ–°å¢çŠ¶æ€é€šçŸ¥
  - æ˜¾ç¤ºToasté€šçŸ¥
  - æ ¹æ®çŠ¶æ€ç±»å‹æ˜¾ç¤ºä¸åŒæ¶ˆæ¯

- `showToast()` - æ–°å¢Toastç»„ä»¶
  - è‡ªåŠ¨æ˜¾ç¤ºå’Œéšè—
  - æ”¯æŒä¸åŒç±»å‹ï¼ˆsuccess/warning/error/infoï¼‰

### 5. CSSæ ·å¼å¢å¼º âœ…

**å®ç°**: `web/css/style.css`

**æ–°å¢æ ·å¼**:
- `.nav-btn.api-loading` - åŠ è½½çŠ¶æ€æ ·å¼
  - è“è‰²è¾¹æ¡†
  - æ—‹è½¬åŠ¨ç”»
  - åŠ è½½å›¾æ ‡

- `.toast` - Toasté€šçŸ¥æ ·å¼
  - å›ºå®šå®šä½
  - åŠ¨ç”»æ•ˆæœ
  - ä¸åŒç±»å‹é¢œè‰²

- `.toast-success` - æˆåŠŸé€šçŸ¥æ ·å¼
- `.toast-warning` - è­¦å‘Šé€šçŸ¥æ ·å¼
- `.toast-error` - é”™è¯¯é€šçŸ¥æ ·å¼
- `.toast-info` - ä¿¡æ¯é€šçŸ¥æ ·å¼

**åŠ¨ç”»**:
- `@keyframes spin` - æ—‹è½¬åŠ¨ç”»ï¼ˆç”¨äºåŠ è½½çŠ¶æ€ï¼‰

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### çŠ¶æ€ç±»å‹

1. **success** - æˆåŠŸçŠ¶æ€
   - ç»¿è‰²è¾¹æ¡†å’ŒèƒŒæ™¯
   - æ˜¾ç¤ºâœ“å›¾æ ‡
   - Toasté€šçŸ¥ï¼š"{æ¨¡å—} æ“ä½œæˆåŠŸ"

2. **warning** - è­¦å‘ŠçŠ¶æ€
   - æ©™è‰²è¾¹æ¡†å’ŒèƒŒæ™¯
   - æ˜¾ç¤ºâš å›¾æ ‡
   - Toasté€šçŸ¥ï¼š"{æ¨¡å—} æ“ä½œå‘Šè­¦"

3. **error** - é”™è¯¯çŠ¶æ€
   - çº¢è‰²è¾¹æ¡†å’ŒèƒŒæ™¯
   - æ˜¾ç¤ºâœ—å›¾æ ‡
   - Toasté€šçŸ¥ï¼š"{æ¨¡å—} æ“ä½œå¤±è´¥"

4. **loading** - åŠ è½½çŠ¶æ€
   - è“è‰²è¾¹æ¡†å’ŒèƒŒæ™¯
   - æ˜¾ç¤ºæ—‹è½¬å›¾æ ‡
   - çŠ¶æ€æŒ‡ç¤ºå™¨æ˜¾ç¤º"åŠ è½½ä¸­..."

5. **unknown** - æœªçŸ¥çŠ¶æ€
   - é»˜è®¤æ ·å¼
   - ä¸æ˜¾ç¤ºé€šçŸ¥

### çŠ¶æ€è”åŠ¨æµç¨‹

1. **ç”¨æˆ·ç‚¹å‡»å¯¼èˆªæŒ‰é’®**
   - æ›´æ–°æŒ‰é’®activeçŠ¶æ€
   - ä¿å­˜å½“å‰æ¿€æ´»æŒ‰é’®
   - é€šçŸ¥è·¯ç”±çŠ¶æ€å˜åŒ–

2. **APIè°ƒç”¨å¼€å§‹**
   - æ£€æµ‹æ¨¡å—ï¼ˆä»URLæˆ–è¯·æ±‚ä½“ï¼‰
   - è®¾ç½®åŠ è½½çŠ¶æ€
   - æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨

3. **APIè°ƒç”¨å®Œæˆ**
   - è§£æå“åº”çŠ¶æ€
   - æ›´æ–°æ¨¡å—çŠ¶æ€
   - æ›´æ–°æŒ‰é’®çŠ¶æ€
   - æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
   - æ˜¾ç¤ºToasté€šçŸ¥
   - è®°å½•APIå†å²

4. **çŠ¶æ€æŒä¹…åŒ–**
   - ä¿å­˜çŠ¶æ€åˆ°Map
   - è®°å½•åˆ°å†å²
   - æ”¯æŒçŠ¶æ€æ¢å¤

## ğŸ“ æ–‡ä»¶æ¸…å•

1. **è·¯ç”±é…ç½®**:
   - `web/js/routes.js` - è·¯ç”±é…ç½®æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
     - æ·»åŠ è·¯ç”±çŠ¶æ€ç®¡ç†
     - æ·»åŠ çŠ¶æ€ç›‘å¬å™¨
     - æ·»åŠ APIå†å²è®°å½•

2. **åº”ç”¨é€»è¾‘**:
   - `web/js/app.js` - ä¸»åº”ç”¨æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
     - å¢å¼ºå¯¼èˆªåŠŸèƒ½
     - å¢å¼ºAPIæ‹¦æˆªå™¨
     - å¢å¼ºçŠ¶æ€æ›´æ–°
     - æ–°å¢Toasté€šçŸ¥

3. **æ ·å¼æ–‡ä»¶**:
   - `web/css/style.css` - ä¸»æ ·å¼æ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
     - æ–°å¢åŠ è½½çŠ¶æ€æ ·å¼
     - æ–°å¢Toasté€šçŸ¥æ ·å¼
     - æ–°å¢åŠ¨ç”»æ•ˆæœ

## âœ… å®ŒæˆçŠ¶æ€

- [x] å‰ç½®æ ¡éªŒï¼šæ£€æŸ¥å¯¼èˆªçŠ¶æ€è”åŠ¨å®ç°çŠ¶æ€
- [x] å®ç°é¡µé¢çŠ¶æ€è”åŠ¨ï¼ˆæŒ‰é’®çŠ¶æ€ã€æ´»åŠ¨æŒ‡ç¤ºï¼‰
- [x] å®ç°APIå“åº”ç›‘å¬ï¼ˆå…¨å±€ç›‘å¬å™¨ï¼‰
- [x] å®ç°å¯¼èˆªçŠ¶æ€æ›´æ–°ï¼ˆæˆåŠŸ/å‘Šè­¦ï¼‰
- [x] å®ç°ç»Ÿä¸€çŠ¶æ€ç®¡ç†
- [x] æ·»åŠ åŠ è½½çŠ¶æ€æŒ‡ç¤ºå’Œæ“ä½œåé¦ˆ
- [x] æ·»åŠ çŠ¶æ€æŒä¹…åŒ–

## ğŸ¯ ç”Ÿäº§çº§æ ‡å‡†è¾¾æˆ

### å®Œæ•´æ€§
- âœ… æ‰€æœ‰å¯¼èˆªæŒ‰é’®éƒ½æœ‰çŠ¶æ€è”åŠ¨
- âœ… æ‰€æœ‰APIè°ƒç”¨éƒ½æœ‰çŠ¶æ€ç›‘å¬
- âœ… æ‰€æœ‰çŠ¶æ€å˜åŒ–éƒ½æœ‰è§†è§‰åé¦ˆ

### ç”¨æˆ·ä½“éªŒ
- âœ… æ¸…æ™°çš„è§†è§‰åé¦ˆï¼ˆé¢œè‰²ã€å›¾æ ‡ã€åŠ¨ç”»ï¼‰
- âœ… åŠæ—¶çš„çŠ¶æ€é€šçŸ¥ï¼ˆToastï¼‰
- âœ… ç›´è§‚çš„çŠ¶æ€æŒ‡ç¤ºï¼ˆé¡¶éƒ¨æŒ‡ç¤ºå™¨ï¼‰

### å¯é æ€§
- âœ… çŠ¶æ€æŒä¹…åŒ–ï¼ˆMapå­˜å‚¨ï¼‰
- âœ… å†å²è®°å½•ï¼ˆè°ƒè¯•æ”¯æŒï¼‰
- âœ… é”™è¯¯å¤„ç†ï¼ˆå¼‚å¸¸æ•è·ï¼‰

### å¯ç»´æŠ¤æ€§
- âœ… ç»Ÿä¸€çš„çŠ¶æ€ç®¡ç†
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„
- âœ… å®Œå–„çš„æ³¨é‡Š

## ğŸ“Œ ä½¿ç”¨ç¤ºä¾‹

### 1. ç›‘å¬è·¯ç”±çŠ¶æ€å˜åŒ–

```javascript
// æ·»åŠ è·¯ç”±çŠ¶æ€ç›‘å¬å™¨
window.addRouteStateListener((module, status) => {
    console.log(`æ¨¡å— ${module} çŠ¶æ€å˜ä¸º ${status}`);
});
```

### 2. è·å–å½“å‰è·¯ç”±çŠ¶æ€

```javascript
// è·å–å½“å‰è·¯ç”±çŠ¶æ€
const currentState = window.ROUTE_STATE.current;
console.log(currentState); // { module: 'rag', status: 'success', timestamp: ... }
```

### 3. è·å–APIè°ƒç”¨å†å²

```javascript
// è·å–APIè°ƒç”¨å†å²
const apiHistory = window.ROUTE_STATE.apiHistory;
console.log(apiHistory); // [{ module: 'rag', status: 'success', ... }, ...]
```

## ğŸš€ ä¸‹ä¸€æ­¥

ç³»ç»Ÿå·²è¾¾åˆ°ç”Ÿäº§æ°´å¹³ï¼Œå¯ä»¥ï¼š
1. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
2. ç›‘æ§å¯¼èˆªçŠ¶æ€å˜åŒ–
3. åˆ†æAPIè°ƒç”¨å†å²
4. ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ


<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å†…å®¹åˆ›ä½œ - è¯¦æƒ…/æ‰§è¡Œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: white;
            color: #f59e0b;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .content-editor {
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="contentTitle">ğŸ¨ å†…å®¹è¯¦æƒ…</h1>
            <p id="contentSubtitle">ç¼–è¾‘å’Œå‘å¸ƒå†…å®¹</p>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="window.location.href='level2.html'">â† è¿”å›åˆ—è¡¨</button>
                <button class="btn btn-secondary" onclick="publishContent()">ğŸ“¤ å‘å¸ƒ</button>
                <button class="btn btn-secondary" onclick="generateContent()">âœ¨ AIç”Ÿæˆ</button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-title">å†…å®¹ç¼–è¾‘</div>
            <input type="text" id="contentTitleInput" placeholder="æ ‡é¢˜..." style="width:100%;padding:12px;margin-bottom:15px;border:1px solid #ddd;border-radius:8px;font-size:16px;">
            <textarea class="content-editor" id="contentEditor" placeholder="åœ¨æ­¤è¾“å…¥å†…å®¹..."></textarea>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveContent()">ğŸ’¾ ä¿å­˜</button>
                <button class="btn btn-primary" onclick="previewContent()">ğŸ‘ï¸ é¢„è§ˆ</button>
                <button class="btn btn-primary" onclick="publishContent()">ğŸ“¤ å‘å¸ƒ</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = '/api/super-agent';
        const API_KEY = localStorage.getItem('api_key') || 'default_key';
        const urlParams = new URLSearchParams(window.location.search);
        const contentId = urlParams.get('content_id');
        const action = urlParams.get('action');
        
        async function loadContent() {
            if (action === 'create') {
                document.getElementById('contentTitle').textContent = 'ğŸ¨ åˆ›å»ºæ–°å†…å®¹';
                return;
            }
            
            if (!contentId) {
                document.getElementById('contentEditor').value = 'è¯·é€‰æ‹©å†…å®¹';
                return;
            }
            
            try {
                const res = await fetch(`${API_BASE}/content/${contentId}`, {
                    headers: { 'X-API-Key': API_KEY }
                });
                const content = await res.json();
                
                document.getElementById('contentTitle').textContent = content.title || 'å†…å®¹è¯¦æƒ…';
                document.getElementById('contentTitleInput').value = content.title || '';
                document.getElementById('contentEditor').value = content.content || '';
            } catch (error) {
                console.error('åŠ è½½å†…å®¹å¤±è´¥:', error);
            }
        }
        
        async function saveContent() {
            const title = document.getElementById('contentTitleInput').value;
            const content = document.getElementById('contentEditor').value;
            
            try {
                const method = contentId ? 'PUT' : 'POST';
                const url = contentId ? `${API_BASE}/content/${contentId}` : `${API_BASE}/content`;
                const res = await fetch(url, {
                    method: method,
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, content })
                });
                const result = await res.json();
                if (result.success) {
                    alert('ä¿å­˜æˆåŠŸ');
                    if (!contentId && result.content_id) {
                        window.location.href = `level3.html?content_id=${result.content_id}`;
                    }
                } else {
                    alert('ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥');
            }
        }
        
        async function publishContent() {
            if (!contentId) {
                alert('è¯·å…ˆä¿å­˜å†…å®¹');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦å‘å¸ƒè¿™ä¸ªå†…å®¹å—ï¼Ÿ')) return;
            
            try {
                const res = await fetch(`${API_BASE}/content/${contentId}/publish`, {
                    method: 'POST',
                    headers: { 'X-API-Key': API_KEY }
                });
                const result = await res.json();
                if (result.success) {
                    alert('å‘å¸ƒæˆåŠŸ');
                } else {
                    alert('å‘å¸ƒå¤±è´¥');
                }
            } catch (error) {
                console.error('å‘å¸ƒå¤±è´¥:', error);
                alert('å‘å¸ƒå¤±è´¥');
            }
        }
        
        async function generateContent() {
            const prompt = prompt('è¯·è¾“å…¥ç”Ÿæˆæç¤ºè¯:');
            if (!prompt) return;
            
            try {
                document.getElementById('contentEditor').value = 'ç”Ÿæˆä¸­...';
                const res = await fetch(`${API_BASE}/content/generate`, {
                    method: 'POST',
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prompt })
                });
                const result = await res.json();
                if (result.content) {
                    document.getElementById('contentEditor').value = result.content;
                    if (result.title) {
                        document.getElementById('contentTitleInput').value = result.title;
                    }
                } else {
                    alert('ç”Ÿæˆå¤±è´¥');
                }
            } catch (error) {
                console.error('ç”Ÿæˆå¤±è´¥:', error);
                alert('ç”Ÿæˆå¤±è´¥');
            }
        }
        
        function previewContent() {
            const content = document.getElementById('contentEditor').value;
            const title = document.getElementById('contentTitleInput').value;
            const preview = window.open('', '_blank');
            preview.document.write(`
                <html>
                    <head><title>${title || 'é¢„è§ˆ'}</title></head>
                    <body style="padding:40px;font-family:inherit;max-width:800px;margin:0 auto;">
                        <h1>${title || 'æ— æ ‡é¢˜'}</h1>
                        <div style="white-space:pre-wrap;line-height:1.8;">${content}</div>
                    </body>
                </html>
            `);
        }
        
        // åˆå§‹åŒ–
        loadContent();
    </script>
</body>
</html>


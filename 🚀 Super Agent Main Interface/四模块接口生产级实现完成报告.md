# å››æ¨¡å—æ¥å£ç”Ÿäº§çº§å®ç°å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ å‰ç½®æ ¡éªŒç»“æœ

### âœ… ç°æœ‰å®ç°æ£€æŸ¥
- âœ… `configurable_api_connector` å·²å­˜åœ¨
- âœ… éƒ¨åˆ†æ¥å£å·²å®ç°ï¼ˆæŸ¥è¯¢ã€æ‰§è¡Œã€å›å†™ï¼‰
- âœ… æƒé™æ ¡éªŒä¾èµ–å·²å®šä¹‰
- âš ï¸ åªæ³¨å†Œäº†RAGè¿æ¥å™¨ï¼Œç¼ºå°‘ERPã€å†…å®¹ã€è¶‹åŠ¿è¿æ¥å™¨
- âš ï¸ ç¼ºå°‘åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ¥å£

## âœ… ç”Ÿäº§çº§æ”¹è¿›å®Œæˆ

### 1. æ¨¡å—APIé€‚é…å™¨ âœ…

**å®ç°**: `core/module_api_adapters.py`

**é€‚é…å™¨ç±»**:
- `ERPAPIConnector` - ERPæ¨¡å—APIè¿æ¥å™¨
- `ContentAPIConnector` - å†…å®¹æ¨¡å—APIè¿æ¥å™¨
- `TrendAPIConnector` - è¶‹åŠ¿æ¨¡å—APIè¿æ¥å™¨

**ç‰¹æ€§**:
- ç»Ÿä¸€çš„åŸºç±»ç»§æ‰¿ï¼ˆBaseAPIConnectorï¼‰
- è‡ªåŠ¨è®¤è¯å¤´å¤„ç†
- å¯é…ç½®çš„API URL
- æ”¯æŒAPIå¯†é’¥è®¤è¯

### 2. è¿æ¥å™¨æ³¨å†Œ âœ…

**å®ç°**: åœ¨ `super_agent_api.py` ä¸­æ³¨å†Œæ‰€æœ‰æ¨¡å—è¿æ¥å™¨

**æ³¨å†Œçš„æ¨¡å—**:
- âœ… RAGæ¨¡å—ï¼ˆå·²å­˜åœ¨ï¼Œä¿æŒä¸å˜ï¼‰
- âœ… ERPæ¨¡å—ï¼ˆæ–°å¢ï¼‰
- âœ… å†…å®¹æ¨¡å—ï¼ˆæ–°å¢ï¼‰
- âœ… è¶‹åŠ¿æ¨¡å—ï¼ˆæ–°å¢ï¼‰

**é…ç½®**:
```python
# ERPè¿æ¥å™¨
configurable_api_connector.register_connector("erp", ERPAPIConnector, {
    "erp_api_url": os.getenv("ERP_API_URL", "http://localhost:8013"),
    "api_key": os.getenv("ERP_API_KEY", ""),
})

# å†…å®¹è¿æ¥å™¨
configurable_api_connector.register_connector("content", ContentAPIConnector, {
    "content_api_url": os.getenv("CONTENT_API_URL", "http://localhost:8016"),
    "api_key": os.getenv("CONTENT_API_KEY", ""),
})

# è¶‹åŠ¿è¿æ¥å™¨
configurable_api_connector.register_connector("trend", TrendAPIConnector, {
    "trend_api_url": os.getenv("TREND_API_URL", "http://localhost:8015"),
    "api_key": os.getenv("TREND_API_KEY", ""),
})
```

### 3. è¡¥é½æ¥å£ âœ…

#### RAGæ¨¡å—æ¥å£

**æŸ¥è¯¢æ¥å£**:
- âœ… `GET /rag/documents` - æŸ¥è¯¢æ–‡æ¡£åˆ—è¡¨
- âœ… `GET /rag/documents/{doc_id}` - æŸ¥è¯¢æ–‡æ¡£è¯¦æƒ…
- âœ… `GET /rag/search` - æ‰§è¡Œæ£€ç´¢
- âœ… `GET /rag/stats` - è·å–ç»Ÿè®¡ä¿¡æ¯

**æ‰§è¡Œæ¥å£**:
- âœ… `POST /rag/documents` - åˆ›å»ºæ–‡æ¡£ï¼ˆæ–°å¢ï¼‰
- âœ… `PUT /rag/documents/{doc_id}` - æ›´æ–°æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰
- âœ… `DELETE /rag/documents/{doc_id}` - åˆ é™¤æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰

**å›å†™æ¥å£**:
- âœ… `POST /rag/writeback` - æ•°æ®å›å†™

#### ERPæ¨¡å—æ¥å£

**æŸ¥è¯¢æ¥å£**:
- âœ… `GET /erp/orders` - æŸ¥è¯¢è®¢å•åˆ—è¡¨
- âœ… `GET /erp/orders/{order_id}` - æŸ¥è¯¢è®¢å•è¯¦æƒ…
- âœ… `GET /erp/customers` - æŸ¥è¯¢å®¢æˆ·åˆ—è¡¨
- âœ… `GET /erp/customers/{customer_id}` - æŸ¥è¯¢å®¢æˆ·è¯¦æƒ…
- âœ… `GET /erp/projects` - æŸ¥è¯¢é¡¹ç›®åˆ—è¡¨
- âœ… `GET /erp/projects/{project_id}` - æŸ¥è¯¢é¡¹ç›®è¯¦æƒ…
- âœ… `GET /erp/inventory` - æŸ¥è¯¢åº“å­˜åˆ—è¡¨
- âœ… `GET /erp/inventory/{item_id}` - æŸ¥è¯¢åº“å­˜è¯¦æƒ…

**æ‰§è¡Œæ¥å£**:
- âœ… `POST /erp/orders` - åˆ›å»ºè®¢å•ï¼ˆæ–°å¢ï¼‰
- âœ… `PUT /erp/orders/{order_id}` - æ›´æ–°è®¢å•ï¼ˆæ–°å¢ï¼‰
- âœ… `DELETE /erp/orders/{order_id}` - åˆ é™¤è®¢å•ï¼ˆæ–°å¢ï¼‰
- âœ… `POST /erp/{type}/{id}/execute` - æ‰§è¡Œæ“ä½œï¼ˆæ‰¹å‡†ã€æ‹’ç»ç­‰ï¼‰

**å›å†™æ¥å£**:
- âœ… `POST /erp/writeback` - æ•°æ®å›å†™

#### å†…å®¹æ¨¡å—æ¥å£

**æŸ¥è¯¢æ¥å£**:
- âœ… `GET /content/list` - æŸ¥è¯¢å†…å®¹åˆ—è¡¨
- âœ… `GET /content/{content_id}` - æŸ¥è¯¢å†…å®¹è¯¦æƒ…
- âœ… `GET /content/materials` - æŸ¥è¯¢ç´ æåˆ—è¡¨
- âœ… `GET /content/published` - æŸ¥è¯¢å·²å‘å¸ƒå†…å®¹

**æ‰§è¡Œæ¥å£**:
- âœ… `POST /content/create` - åˆ›å»ºå†…å®¹ï¼ˆæ–°å¢ï¼‰
- âœ… `PUT /content/{content_id}` - æ›´æ–°å†…å®¹ï¼ˆæ–°å¢ï¼‰
- âœ… `DELETE /content/{content_id}` - åˆ é™¤å†…å®¹ï¼ˆæ–°å¢ï¼‰
- âœ… `POST /content/generate` - æ‰§è¡Œå†…å®¹ç”Ÿæˆ
- âœ… `POST /content/{content_id}/publish` - æ‰§è¡Œå†…å®¹å‘å¸ƒ

**å›å†™æ¥å£**:
- âœ… `POST /content/writeback` - æ•°æ®å›å†™

#### è¶‹åŠ¿æ¨¡å—æ¥å£

**æŸ¥è¯¢æ¥å£**:
- âœ… `GET /trend/reports` - æŸ¥è¯¢æŠ¥å‘Šåˆ—è¡¨
- âœ… `GET /trend/reports/{report_id}` - æŸ¥è¯¢æŠ¥å‘Šè¯¦æƒ…
- âœ… `GET /trend/indicators` - æŸ¥è¯¢æŒ‡æ ‡åˆ—è¡¨
- âœ… `GET /trend/indicators/{indicator_id}` - æŸ¥è¯¢æŒ‡æ ‡è¯¦æƒ…
- âœ… `GET /trend/analysis/tasks` - æŸ¥è¯¢åˆ†æä»»åŠ¡åˆ—è¡¨
- âœ… `GET /trend/analysis/tasks/{task_id}` - æŸ¥è¯¢åˆ†æä»»åŠ¡è¯¦æƒ…
- âœ… `GET /trend/reports/{report_id}/export` - å¯¼å‡ºæŠ¥å‘Š

**æ‰§è¡Œæ¥å£**:
- âœ… `POST /trend/reports` - åˆ›å»ºæŠ¥å‘Šï¼ˆæ–°å¢ï¼‰
- âœ… `PUT /trend/reports/{report_id}` - æ›´æ–°æŠ¥å‘Šï¼ˆæ–°å¢ï¼‰
- âœ… `DELETE /trend/reports/{report_id}` - åˆ é™¤æŠ¥å‘Šï¼ˆæ–°å¢ï¼‰
- âœ… `POST /trend/analysis/start` - å¯åŠ¨åˆ†æä»»åŠ¡
- âœ… `POST /trend/analysis/execute` - æ‰§è¡Œåˆ†æ

**å›å†™æ¥å£**:
- âœ… `POST /trend/writeback` - æ•°æ®å›å†™

### 4. æƒé™æ ¡éªŒ âœ…

**æ‰€æœ‰æ¥å£éƒ½é…ç½®äº†æƒé™æ ¡éªŒ**:
- æŸ¥è¯¢æ¥å£ï¼šä½¿ç”¨ `{module}_read_dep`
- æ‰§è¡Œæ¥å£ï¼šä½¿ç”¨ `{module}_write_dep`
- å›å†™æ¥å£ï¼šä½¿ç”¨ `{module}_write_dep`

**æƒé™ä¾èµ–**:
```python
rag_read_dep = permission_guard.require("rag:read")
rag_write_dep = permission_guard.require("rag:write")
erp_read_dep = permission_guard.require("erp:read")
erp_write_dep = permission_guard.require("erp:write")
content_read_dep = permission_guard.require("content:read")
content_write_dep = permission_guard.require("content:write")
trend_read_dep = permission_guard.require("trend:read")
trend_write_dep = permission_guard.require("trend:write")
```

### 5. ç»Ÿä¸€é”™è¯¯å¤„ç† âœ…

**å®ç°**:
- æ‰€æœ‰æ¥å£éƒ½æœ‰try-catché”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„é”™è¯¯æ—¥å¿—è®°å½•
- ç»Ÿä¸€çš„HTTPå¼‚å¸¸æŠ›å‡º
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### 6. ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼ âœ…

**å®ç°**: `core/module_api_helpers.py`

**åŠŸèƒ½**:
- `standardize_response()` - æ ‡å‡†åŒ–å“åº”æ ¼å¼
- `handle_api_error()` - ç»Ÿä¸€é”™è¯¯å¤„ç†
- `validate_request()` - è¯·æ±‚å‚æ•°éªŒè¯
- `log_api_call()` - APIè°ƒç”¨æ—¥å¿—è®°å½•
- `_filter_sensitive_data()` - æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
- `_limit_data_size()` - æ•°æ®å¤§å°é™åˆ¶

**å“åº”æ ¼å¼**:
```json
{
    "success": true,
    "timestamp": "2025-01-15T10:30:00Z",
    "data": {...},
    "count": 0,
    "limit": 50,
    "offset": 0
}
```

**é”™è¯¯å“åº”æ ¼å¼**:
```json
{
    "success": false,
    "timestamp": "2025-01-15T10:30:00Z",
    "message": "é”™è¯¯ä¿¡æ¯",
    "data": {}
}
```

### 7. è¯·æ±‚éªŒè¯å’Œæ—¥å¿—è®°å½• âœ…

**è¯·æ±‚éªŒè¯**:
- å¿…éœ€å­—æ®µæ£€æŸ¥
- å¯é€‰å­—æ®µæ£€æŸ¥
- å­—æ®µç±»å‹éªŒè¯ï¼ˆå¯æ‰©å±•ï¼‰

**æ—¥å¿—è®°å½•**:
- è®°å½•æ‰€æœ‰APIè°ƒç”¨
- è®°å½•è¯·æ±‚å’Œå“åº”ï¼ˆè¿‡æ»¤æ•æ„Ÿä¿¡æ¯ï¼‰
- è®°å½•æ‰§è¡Œæ—¶é•¿
- è®°å½•æˆåŠŸ/å¤±è´¥çŠ¶æ€
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼

**æ—¥å¿—æ ¼å¼**:
```json
{
    "module": "rag",
    "operation": "get_documents",
    "success": true,
    "timestamp": "2025-01-15T10:30:00Z",
    "duration": 0.123,
    "request": {...},
    "response_summary": {...}
}
```

## ğŸ“Š æ¥å£ç»Ÿè®¡

| æ¨¡å— | æŸ¥è¯¢æ¥å£ | æ‰§è¡Œæ¥å£ | å›å†™æ¥å£ | æ€»è®¡ |
|------|---------|---------|---------|------|
| RAG | 4 | 4 | 1 | 9 |
| ERP | 8 | 4 | 1 | 13 |
| å†…å®¹ | 4 | 5 | 1 | 10 |
| è¶‹åŠ¿ | 7 | 5 | 1 | 13 |
| **æ€»è®¡** | **23** | **18** | **4** | **45** |

## ğŸ“ æ–‡ä»¶æ¸…å•

1. **é€‚é…å™¨æ¨¡å—**:
   - `core/module_api_adapters.py` - æ¨¡å—APIé€‚é…å™¨ï¼ˆæ–°å»ºï¼‰
   - `core/module_api_helpers.py` - æ¨¡å—APIè¾…åŠ©å‡½æ•°ï¼ˆæ–°å»ºï¼‰

2. **APIæ¥å£**:
   - `api/super_agent_api.py` - ä¸»APIæ–‡ä»¶ï¼ˆå·²æ›´æ–°ï¼‰
     - æ³¨å†Œæ‰€æœ‰æ¨¡å—è¿æ¥å™¨
     - è¡¥é½æ‰€æœ‰CRUDæ¥å£
     - æ‰€æœ‰æ¥å£éƒ½æœ‰æƒé™æ ¡éªŒ
     - ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
     - è¯·æ±‚éªŒè¯å’Œæ—¥å¿—è®°å½•

## âœ… å®ŒæˆçŠ¶æ€

- [x] å‰ç½®æ ¡éªŒï¼šæ£€æŸ¥å››æ¨¡å—æ¥å£å®ç°çŠ¶æ€
- [x] åˆ›å»ºæ¨¡å—APIé€‚é…å™¨ï¼ˆERPã€å†…å®¹ã€è¶‹åŠ¿ï¼‰
- [x] æ³¨å†Œæ‰€æœ‰æ¨¡å—è¿æ¥å™¨
- [x] è¡¥é½RAGæ¨¡å—çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ¥å£
- [x] è¡¥é½ERPæ¨¡å—çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ¥å£
- [x] è¡¥é½å†…å®¹æ¨¡å—çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ¥å£
- [x] è¡¥é½è¶‹åŠ¿æ¨¡å—çš„åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ¥å£
- [x] ç¡®ä¿æ‰€æœ‰æ¥å£éƒ½æœ‰æƒé™æ ¡éªŒ
- [x] ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

## ğŸ¯ ç”Ÿäº§çº§æ ‡å‡†è¾¾æˆ

### å®Œæ•´æ€§
- âœ… æ‰€æœ‰æ¨¡å—éƒ½æœ‰æŸ¥è¯¢ã€æ‰§è¡Œã€å›å†™æ¥å£
- âœ… æ‰€æœ‰æ¨¡å—éƒ½æœ‰CRUDæ“ä½œ
- âœ… æ‰€æœ‰æ¥å£éƒ½ä½¿ç”¨configurable_api_connector

### å®‰å…¨æ€§
- âœ… æ‰€æœ‰æ¥å£éƒ½æœ‰æƒé™æ ¡éªŒ
- âœ… è¯»æ“ä½œä½¿ç”¨readæƒé™
- âœ… å†™æ“ä½œä½¿ç”¨writeæƒé™

### å¯é æ€§
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- âœ… ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… è¯·æ±‚å‚æ•°éªŒè¯
- âœ… æ•æ„Ÿä¿¡æ¯è¿‡æ»¤

### å¯ç»´æŠ¤æ€§
- âœ… ç»Ÿä¸€çš„é€‚é…å™¨æ¨¡å¼
- âœ… å¯é…ç½®çš„API URL
- âœ… æ¸…æ™°çš„ä»£ç ç»“æ„

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **API URLé…ç½®**: é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼Œé»˜è®¤ä½¿ç”¨localhost
2. **APIå¯†é’¥**: é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼Œå¯é€‰
3. **æƒé™æ ¡éªŒ**: æ‰€æœ‰æ¥å£éƒ½é€šè¿‡ä¾èµ–æ³¨å…¥è¿›è¡Œæƒé™æ ¡éªŒ
4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰æ¥å£éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. æŸ¥è¯¢RAGæ–‡æ¡£

```bash
GET /api/super-agent/rag/documents?limit=20&offset=0
Headers: X-API-Key: your_api_key
```

### 2. åˆ›å»ºERPè®¢å•

```bash
POST /api/super-agent/erp/orders
Headers: X-API-Key: your_api_key
Body: {
    "customer_id": "cust_123",
    "items": [...],
    "total_amount": 1000.00
}
```

### 3. ç”Ÿæˆå†…å®¹

```bash
POST /api/super-agent/content/generate
Headers: X-API-Key: your_api_key
Body: {
    "prompt": "å†™ä¸€ç¯‡å…³äºAIçš„æ–‡ç« ",
    "content_type": "article",
    "platform": "xiaohongshu"
}
```

### 4. å¯åŠ¨è¶‹åŠ¿åˆ†æ

```bash
POST /api/super-agent/trend/analysis/start
Headers: X-API-Key: your_api_key
Body: {
    "indicator": "EV_DEMAND",
    "analysis_type": "standard"
}
```

## ğŸš€ ä¸‹ä¸€æ­¥

ç³»ç»Ÿå·²è¾¾åˆ°ç”Ÿäº§æ°´å¹³ï¼Œå¯ä»¥ï¼š
1. éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
2. é…ç½®å„æ¨¡å—çš„API URLå’Œå¯†é’¥
3. é…ç½®æƒé™ç­–ç•¥
4. ç›‘æ§APIè°ƒç”¨æƒ…å†µ


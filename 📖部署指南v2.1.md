# ğŸ“– AI Stack éƒ¨ç½²æŒ‡å— v2.1

**ç‰ˆæœ¬**: 2.1.0  
**æ›´æ–°æ—¶é—´**: 2025-11-07  
**é€‚ç”¨ç¯å¢ƒ**: å¼€å‘/æµ‹è¯•/ç”Ÿäº§

---

## ğŸ“‘ ç›®å½•

- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [Dockeréƒ¨ç½²](#dockeréƒ¨ç½²)
- [Kuberneteséƒ¨ç½²](#kuberneteséƒ¨ç½²)
- [ç›‘æ§é…ç½®](#ç›‘æ§é…ç½®)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### ç¡¬ä»¶è¦æ±‚

| ç¯å¢ƒ | CPU | å†…å­˜ | ç£ç›˜ | ç½‘ç»œ |
|------|-----|------|------|------|
| **æœ€å°** | 4æ ¸ | 8GB | 50GB | 100Mbps |
| **æ¨è** | 8æ ¸ | 16GB | 100GB | 1Gbps |
| **ç”Ÿäº§** | 16æ ¸ | 32GB | 500GB | 10Gbps |

### è½¯ä»¶è¦æ±‚

| è½¯ä»¶ | ç‰ˆæœ¬ | å¿…éœ€ |
|------|------|------|
| **Docker** | 20.10+ | âœ… |
| **Docker Compose** | 2.0+ | âœ… |
| **Python** | 3.11+ | âœ… |
| **Node.js** | 18+ | âš ï¸ (ERPå‰ç«¯) |
| **Kubernetes** | 1.24+ | âŒ (å¯é€‰) |

---

## ğŸ³ Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ–¹å¼1ï¼šå¿«é€Ÿå¯åŠ¨ï¼ˆæ‰€æœ‰æœåŠ¡ï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository_url>
cd ai-stack-super-enhanced

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp env.example .env
nano .env  # ç¼–è¾‘é…ç½®

# 3. ä¸€é”®å¯åŠ¨
docker-compose up -d

# 4. æŸ¥çœ‹çŠ¶æ€
docker-compose ps

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹å¼2ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
# ç»Ÿä¸€å¯åŠ¨è„šæœ¬
./scripts/start_all_services.sh

# ç­‰å¾…æœåŠ¡å°±ç»ªï¼ˆçº¦2åˆ†é’Ÿï¼‰
sleep 120

# å¥åº·æ£€æŸ¥
python3 scripts/health_check.py
```

### æ–¹å¼3ï¼šå•ç‹¬å¯åŠ¨æœåŠ¡

```bash
# åªå¯åŠ¨RAGæœåŠ¡
cd "ğŸ“š Enhanced RAG & Knowledge Graph"
./start_rag.sh

# åªå¯åŠ¨ERPæœåŠ¡
cd "ğŸ’¼ Intelligent ERP & Business Management"
./å¯åŠ¨æœåŠ¡.sh
```

---

## â˜¸ï¸ Kuberneteséƒ¨ç½²âœ¨ [æ–°å¢]

### å‰ææ¡ä»¶

1. K8sé›†ç¾¤å·²å°±ç»ª
2. kubectlå·²é…ç½®
3. æœ‰è¶³å¤Ÿçš„èµ„æºé…é¢

### éƒ¨ç½²æ­¥éª¤

#### 1. åˆ›å»ºå‘½åç©ºé—´
```bash
kubectl create namespace ai-stack
```

#### 2. é…ç½®Secret
```bash
# åˆ›å»ºæ•°æ®åº“å¯†ç 
kubectl create secret generic ai-stack-secrets \
  --from-literal=db-password=your_password \
  --from-literal=api-key=your_api_key \
  -n ai-stack

# åˆ›å»ºé•œåƒæ‹‰å–å¯†é’¥
kubectl create secret docker-registry regcred \
  --docker-server=registry.example.com \
  --docker-username=your_username \
  --docker-password=your_password \
  -n ai-stack
```

#### 3. éƒ¨ç½²ConfigMap
```bash
kubectl apply -f infra/k8s/configmap.yaml -n ai-stack
```

#### 4. éƒ¨ç½²æœåŠ¡
```bash
# éƒ¨ç½²æ‰€æœ‰æœåŠ¡
kubectl apply -f infra/k8s/deployment.yaml -n ai-stack
kubectl apply -f infra/k8s/service.yaml -n ai-stack
kubectl apply -f infra/k8s/ingress.yaml -n ai-stack
```

#### 5. éªŒè¯éƒ¨ç½²
```bash
# æŸ¥çœ‹PodçŠ¶æ€
kubectl get pods -n ai-stack

# æŸ¥çœ‹æœåŠ¡
kubectl get svc -n ai-stack

# æŸ¥çœ‹Ingress
kubectl get ingress -n ai-stack

# æŸ¥çœ‹æ—¥å¿—
kubectl logs -f deployment/ai-stack-rag -n ai-stack
```

#### 6. æ‰©ç¼©å®¹
```bash
# æ‰‹åŠ¨æ‰©å®¹
kubectl scale deployment/ai-stack-rag --replicas=3 -n ai-stack

# é…ç½®HPAè‡ªåŠ¨æ‰©ç¼©å®¹
kubectl apply -f infra/k8s/hpa.yaml -n ai-stack
```

---

## ğŸ“Š ç›‘æ§é…ç½®

### å¯åŠ¨ç›‘æ§æœåŠ¡

```bash
# å¯åŠ¨Prometheus + Grafana
cd monitoring
docker-compose -f docker-compose.monitoring.yml up -d

# ç­‰å¾…å¯åŠ¨
sleep 30

# è®¿é—®Grafana
open http://localhost:3001
# é»˜è®¤è´¦å·: admin / admin123
```

### Grafanaé…ç½®

#### 1. é¦–æ¬¡ç™»å½•
- URL: `http://localhost:3001`
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

#### 2. æ·»åŠ æ•°æ®æºï¼ˆè‡ªåŠ¨é…ç½®ï¼‰
- Prometheuså·²è‡ªåŠ¨é…ç½®
- URL: `http://prometheus:9090`

#### 3. å¯¼å…¥ä»ªè¡¨æ¿
- ç³»ç»Ÿæ¦‚è§ˆ: Dashboard ID 1
- æœåŠ¡è¯¦æƒ…: Dashboard ID 2
- ä¸šåŠ¡æŒ‡æ ‡: Dashboard ID 3

### å‘Šè­¦é…ç½®

#### 1. é…ç½®é€šçŸ¥æ¸ é“

ç¼–è¾‘ `monitoring/alertmanager.yml`:

```yaml
receivers:
  - name: 'email-alerts'
    email_configs:
      - to: 'your-email@example.com'
```

#### 2. é…ç½®é’‰é’‰é€šçŸ¥

```yaml
receivers:
  - name: 'dingtalk-alerts'
    webhook_configs:
      - url: 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN'
```

---

## ğŸ” ç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. ç¯å¢ƒå˜é‡

åˆ›å»º `.env.production`:

```bash
# åŸºç¡€é…ç½®
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# æ•°æ®åº“
DATABASE_URL=postgresql://user:pass@host:5432/aistack
REDIS_URL=redis://redis:6379/0

# AIé…ç½®
OLLAMA_API=http://ollama:11434
OPENAI_API_KEY=sk-your-key

# å®‰å…¨
SECRET_KEY=your-secret-key-here
JWT_SECRET=your-jwt-secret
API_KEY_SALT=your-salt

# ç›‘æ§
PROMETHEUS_ENABLED=true
METRICS_PORT=9090
```

### 2. åå‘ä»£ç†é…ç½®

Nginxé…ç½®ç¤ºä¾‹:

```nginx
# /etc/nginx/sites-available/aistack

upstream ai_stack_backend {
    server 127.0.0.1:8011;
    server 127.0.0.1:8013;
    keepalive 32;
}

server {
    listen 80;
    server_name aistack.example.com;
    
    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name aistack.example.com;
    
    # SSLè¯ä¹¦
    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    
    # SSLé…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    
    # æ—¥å¿—
    access_log /var/log/nginx/aistack_access.log;
    error_log /var/log/nginx/aistack_error.log;
    
    # ä»£ç†é…ç½®
    location /api/ {
        proxy_pass http://ai_stack_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # é™æ€æ–‡ä»¶
    location /static/ {
        alias /var/www/aistack/static/;
        expires 30d;
    }
}
```

### 3. æ•°æ®åº“é…ç½®

PostgreSQLé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:

```bash
# åˆ›å»ºæ•°æ®åº“
createdb aistack_prod

# åˆ›å»ºç”¨æˆ·
createuser -P aistack_user

# æˆæƒ
psql -c "GRANT ALL PRIVILEGES ON DATABASE aistack_prod TO aistack_user;"

# åˆå§‹åŒ–è¡¨ç»“æ„
python scripts/init_database.py
```

---

## ğŸ”¥ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8011
lsof -i :8013

# æ£€æŸ¥Docker
docker ps
docker logs <container_id>

# æ£€æŸ¥æ—¥å¿—
tail -f logs/*.log
```

#### 2. APIè°ƒç”¨å¤±è´¥

```bash
# æµ‹è¯•æœåŠ¡è¿é€šæ€§
curl http://localhost:8011/health
curl http://localhost:8013/health

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ç½‘ç»œ
docker network ls
docker network inspect ai-stack-network
```

#### 3. æ€§èƒ½é—®é¢˜

```bash
# æŸ¥çœ‹èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
htop

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
tail -f logs/slow_query.log
```

---

## ğŸ“ ç»´æŠ¤æ“ä½œ

### å¤‡ä»½

```bash
# æ•°æ®å¤‡ä»½
python scripts/backup_restore.py backup

# Dockerå·å¤‡ä»½
docker run --rm \
  -v ai-stack-data:/data \
  -v $(pwd)/backups:/backup \
  alpine tar czf /backup/data-$(date +%Y%m%d).tar.gz /data
```

### æ›´æ–°

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# æ»šåŠ¨æ›´æ–°
docker-compose up -d --no-deps --build <service_name>
```

### æ¸…ç†

```bash
# æ¸…ç†æœªä½¿ç”¨çš„Dockerèµ„æº
docker system prune -a

# æ¸…ç†æ—¥å¿—
find logs/ -name "*.log" -mtime +30 -delete

# æ¸…ç†ç¼“å­˜
rm -rf cache/*
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–
- âœ… æ·»åŠ ç´¢å¼•
- âœ… é…ç½®è¿æ¥æ± 
- âœ… å¯ç”¨æŸ¥è¯¢ç¼“å­˜
- âœ… å®šæœŸVACUUM

### 2. åº”ç”¨ä¼˜åŒ–
- âœ… å¯ç”¨Redisç¼“å­˜
- âœ… é…ç½®CDN
- âœ… å¯ç”¨gzipå‹ç¼©
- âœ… ä½¿ç”¨è¿æ¥æ± 

### 3. ç³»ç»Ÿä¼˜åŒ–
- âœ… è°ƒæ•´æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
- âœ… é…ç½®å†…æ ¸å‚æ•°
- âœ… ä½¿ç”¨SSDå­˜å‚¨
- âœ… é…ç½®ç½‘ç»œä¼˜åŒ–

---

**éƒ¨ç½²æ–‡æ¡£ç‰ˆæœ¬**: v2.1.0  
**æœ€åæ›´æ–°**: 2025-11-07  
**æŠ€æœ¯æ”¯æŒ**: support@aistack.com


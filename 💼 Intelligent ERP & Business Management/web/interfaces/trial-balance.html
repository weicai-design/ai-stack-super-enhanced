<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯•ç®—åŠŸèƒ½ - ERPç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/echarts/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 15px; }
        .result-card { background: #f9f9f9; padding: 15px; border-radius: 4px; margin-top: 15px; }
        .result-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0; }
        .result-item:last-child { border-bottom: none; }
        .recommendations { margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="app">
        <div class="header"><h1>ğŸ§® è¯•ç®—åŠŸèƒ½</h1></div>
        
        <div class="container">
            <el-tabs v-model="activeTab">
                <!-- æ¯æ—¥äº¤ä»˜é‡è¯•ç®— -->
                <el-tab-pane label="æ¯æ—¥äº¤ä»˜é‡è¯•ç®—" name="delivery">
                    <div class="card">
                        <h3>è¯•ç®—è¾¾åˆ°å‘¨ç›®æ ‡éœ€è¦çš„æ¯æ—¥äº¤ä»˜é‡</h3>
                        <el-form :model="deliveryForm" label-width="150px">
                            <el-form-item label="å‘¨ç›®æ ‡è¥ä¸šé¢">
                                <el-input-number v-model="deliveryForm.target_weekly_revenue" :precision="2" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="äº§å“IDï¼ˆå¯é€‰ï¼‰">
                                <el-input-number v-model="deliveryForm.product_id" style="width: 100%" />
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="calculateDelivery">è®¡ç®—</el-button>
                            </el-form-item>
                        </el-form>
                        
                        <div v-if="deliveryResult" class="result-card">
                            <h4>è®¡ç®—ç»“æœ</h4>
                            <div class="result-item"><span>ç›®æ ‡å‘¨è¥ä¸šé¢:</span><strong>Â¥{{ deliveryResult.target_weekly_revenue }}</strong></div>
                            <div class="result-item"><span>äº§å“å•ä»·:</span><strong>Â¥{{ deliveryResult.unit_price }}</strong></div>
                            <div class="result-item"><span>æ€»äº¤ä»˜é‡:</span><strong>{{ deliveryResult.total_quantity_needed }}</strong></div>
                            <div class="result-item"><span>æ¯æ—¥äº¤ä»˜é‡:</span><strong>{{ deliveryResult.daily_quantity }}</strong></div>
                            <div class="result-item"><span>å†å²å¹³å‡:</span>{{ deliveryResult.historical_average }}</div>
                            <div class="result-item"><span>å†å²æœ€å¤§:</span>{{ deliveryResult.historical_max }}</div>
                            <div class="result-item"><span>å¯è¡Œæ€§:</span><el-tag :type="getFeasibilityType(deliveryResult.feasibility.level)">{{ deliveryResult.feasibility.level }}</el-tag></div>
                            <div v-if="deliveryResult.recommendations" class="recommendations">
                                <strong>å»ºè®®:</strong>
                                <ul style="margin-top: 8px;">
                                    <li v-for="rec in deliveryResult.recommendations" :key="rec">{{ rec }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
                
                <!-- ç”Ÿäº§äº§èƒ½è¯•ç®— -->
                <el-tab-pane label="ç”Ÿäº§äº§èƒ½è¯•ç®—" name="capacity">
                    <div class="card">
                        <h3>ç”Ÿäº§äº§èƒ½è¯•ç®—</h3>
                        <el-form :model="capacityForm" label-width="150px">
                            <el-form-item label="ç›®æ ‡äº§é‡">
                                <el-input-number v-model="capacityForm.target_quantity" :precision="2" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="ç”Ÿäº§çº¿æ•°é‡">
                                <el-input-number v-model="capacityForm.production_line_count" :min="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="æ¯å¤©å·¥ä½œå°æ—¶">
                                <el-input-number v-model="capacityForm.hours_per_day" :precision="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="æ¯å‘¨å·¥ä½œå¤©æ•°">
                                <el-input-number v-model="capacityForm.days_per_week" :min="1" :max="7" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="å•ä½äº§å“æ—¶é—´(åˆ†é’Ÿ)">
                                <el-input-number v-model="capacityForm.unit_time_minutes" :precision="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="æ•ˆç‡ç³»æ•°">
                                <el-input-number v-model="capacityForm.efficiency_rate" :precision="2" :min="0" :max="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="calculateCapacity">è®¡ç®—</el-button>
                            </el-form-item>
                        </el-form>
                        
                        <div v-if="capacityResult" class="result-card">
                            <h4>è®¡ç®—ç»“æœ</h4>
                            <div class="result-item"><span>ç›®æ ‡äº§é‡:</span><strong>{{ capacityResult.target_quantity }}</strong></div>
                            <div class="result-item"><span>å•çº¿æ—¥äº§èƒ½:</span>{{ capacityResult.daily_capacity_per_line }}</div>
                            <div class="result-item"><span>æ€»æ—¥äº§èƒ½:</span><strong>{{ capacityResult.total_daily_capacity }}</strong></div>
                            <div class="result-item"><span>å‘¨äº§èƒ½:</span><strong>{{ capacityResult.weekly_capacity }}</strong></div>
                            <div class="result-item"><span>éœ€è¦å¤©æ•°:</span><strong>{{ capacityResult.days_needed }}å¤©</strong></div>
                            <div class="result-item"><span>äº§èƒ½åˆ©ç”¨ç‡:</span><strong>{{ capacityResult.capacity_utilization }}%</strong></div>
                            <div v-if="capacityResult.recommendations" class="recommendations">
                                <strong>å»ºè®®:</strong>
                                <ul style="margin-top: 8px;">
                                    <li v-for="rec in capacityResult.recommendations" :key="rec">{{ rec }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
                
                <!-- æˆæœ¬åˆ†è§£è¯•ç®— -->
                <el-tab-pane label="æˆæœ¬åˆ†è§£è¯•ç®—" name="cost">
                    <div class="card">
                        <h3>æˆæœ¬åˆ†è§£è¯•ç®—</h3>
                        <el-form :model="costForm" label-width="150px">
                            <el-form-item label="ç›®æ ‡æˆæœ¬">
                                <el-input-number v-model="costForm.target_cost" :precision="2" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="æ•°é‡">
                                <el-input-number v-model="costForm.quantity" :min="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="ç‰©æ–™æˆæœ¬å æ¯”">
                                <el-input-number v-model="costForm.material_cost_ratio" :precision="2" :min="0" :max="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="äººå·¥æˆæœ¬å æ¯”">
                                <el-input-number v-model="costForm.labor_cost_ratio" :precision="2" :min="0" :max="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item label="åˆ¶é€ è´¹ç”¨å æ¯”">
                                <el-input-number v-model="costForm.overhead_cost_ratio" :precision="2" :min="0" :max="1" style="width: 100%" />
                            </el-form-item>
                            <el-form-item>
                                <el-button type="primary" @click="calculateCost">è®¡ç®—</el-button>
                            </el-form-item>
                        </el-form>
                        
                        <div v-if="costResult" class="result-card">
                            <h4>è®¡ç®—ç»“æœ</h4>
                            <div class="result-item"><span>æ€»æˆæœ¬:</span><strong>Â¥{{ costResult.total_cost }}</strong></div>
                            <div class="result-item"><span>å•ä½æˆæœ¬:</span><strong>Â¥{{ costResult.unit_total_cost }}</strong></div>
                            <div style="margin-top: 15px;">
                                <h5>æˆæœ¬åˆ†è§£:</h5>
                                <div class="result-item"><span>ç‰©æ–™æˆæœ¬:</span>Â¥{{ costResult.cost_breakdown.material.total }} ({{ costResult.cost_breakdown.material.ratio }}%)</div>
                                <div class="result-item"><span>äººå·¥æˆæœ¬:</span>Â¥{{ costResult.cost_breakdown.labor.total }} ({{ costResult.cost_breakdown.labor.ratio }}%)</div>
                                <div class="result-item"><span>åˆ¶é€ è´¹ç”¨:</span>Â¥{{ costResult.cost_breakdown.overhead.total }} ({{ costResult.cost_breakdown.overhead.ratio }}%)</div>
                            </div>
                            <div v-if="costResult.recommendations" class="recommendations">
                                <strong>å»ºè®®:</strong>
                                <ul style="margin-top: 8px;">
                                    <li v-for="rec in costResult.recommendations" :key="rec">{{ rec }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>
    </div>
    
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    activeTab: 'delivery',
                    deliveryForm: { target_weekly_revenue: 100000, product_id: null },
                    capacityForm: { target_quantity: 1000, production_line_count: 1, hours_per_day: 8, days_per_week: 5, unit_time_minutes: 60, efficiency_rate: 0.85 },
                    costForm: { target_cost: 1000, quantity: 100, material_cost_ratio: 0.6, labor_cost_ratio: 0.2, overhead_cost_ratio: 0.2 },
                    deliveryResult: null,
                    capacityResult: null,
                    costResult: null
                }
            },
            methods: {
                async calculateDelivery() {
                    try {
                        const res = await axios.post('/api/trial-balance/daily-delivery', this.deliveryForm);
                        this.deliveryResult = res.data.result;
                        ElementPlus.ElMessage.success('è®¡ç®—å®Œæˆ');
                    } catch (error) {
                        ElementPlus.ElMessage.error('è®¡ç®—å¤±è´¥: ' + error.message);
                    }
                },
                async calculateCapacity() {
                    try {
                        const res = await axios.post('/api/trial-balance/production-capacity', this.capacityForm);
                        this.capacityResult = res.data.result;
                        ElementPlus.ElMessage.success('è®¡ç®—å®Œæˆ');
                    } catch (error) {
                        ElementPlus.ElMessage.error('è®¡ç®—å¤±è´¥: ' + error.message);
                    }
                },
                async calculateCost() {
                    try {
                        const res = await axios.post('/api/trial-balance/cost-breakdown', this.costForm);
                        this.costResult = res.data.result;
                        ElementPlus.ElMessage.success('è®¡ç®—å®Œæˆ');
                    } catch (error) {
                        ElementPlus.ElMessage.error('è®¡ç®—å¤±è´¥: ' + error.message);
                    }
                },
                getFeasibilityType(level) {
                    const types = { 'easy': 'success', 'moderate': 'warning', 'challenging': 'warning', 'difficult': 'danger' };
                    return types[level] || 'info';
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>


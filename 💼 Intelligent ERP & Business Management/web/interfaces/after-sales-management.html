<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å”®åç®¡ç† - ERPç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-plus/dist/index.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
        .header { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%); color: #333; padding: 20px 30px; }
        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        .stat-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .filter-bar, .table-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <div id="app">
        <div class="header"><h1>ğŸ”§ å”®åç®¡ç†</h1></div>
        <div class="container">
            <div class="stat-cards">
                <div class="stat-card"><div style="color: #666; font-size: 14px;">æœåŠ¡å•æ•°</div><div style="font-size: 28px; font-weight: bold;">{{ statistics.total_tickets }}</div></div>
                <div class="stat-card"><div style="color: #666; font-size: 14px;">å¾…å¤„ç†</div><div style="font-size: 28px; font-weight: bold;">{{ statistics.pending }}</div></div>
                <div class="stat-card"><div style="color: #666; font-size: 14px;">å¤„ç†ä¸­</div><div style="font-size: 28px; font-weight: bold;">{{ statistics.processing }}</div></div>
                <div class="stat-card"><div style="color: #666; font-size: 14px;">å·²å®Œæˆ</div><div style="font-size: 28px; font-weight: bold;">{{ statistics.completed }}</div></div>
            </div>
            <div class="filter-bar">
                <el-form :inline="true">
                    <el-form-item label="æœåŠ¡å•å·"><el-input v-model="filters.ticket_no" placeholder="è¯·è¾“å…¥æœåŠ¡å•å·" clearable style="width: 200px" /></el-form-item>
                    <el-form-item label="ç±»å‹"><el-select v-model="filters.type" clearable style="width: 150px"><el-option label="å…¨éƒ¨" value="" /><el-option label="æŠ•è¯‰" value="complaint" /><el-option label="ç»´ä¿®" value="repair" /><el-option label="é€€è´§" value="return" /></el-select></el-form-item>
                    <el-form-item label="çŠ¶æ€"><el-select v-model="filters.status" clearable style="width: 150px"><el-option label="å…¨éƒ¨" value="" /><el-option label="å¾…å¤„ç†" value="pending" /><el-option label="å¤„ç†ä¸­" value="processing" /><el-option label="å·²å®Œæˆ" value="completed" /></el-select></el-form-item>
                    <el-form-item><el-button type="primary" @click="loadTickets">æŸ¥è¯¢</el-button><el-button type="success" @click="showAddDialog">æ–°å¢æœåŠ¡å•</el-button></el-form-item>
                </el-form>
            </div>
            <div class="table-container">
                <el-table :data="tickets" v-loading="loading" stripe>
                    <el-table-column prop="ticket_no" label="æœåŠ¡å•å·" width="150" />
                    <el-table-column prop="customer_name" label="å®¢æˆ·åç§°" width="150" />
                    <el-table-column prop="type" label="ç±»å‹" width="100"><template #default="scope"><el-tag>{{ getTypeText(scope.row.type) }}</el-tag></template></el-table-column>
                    <el-table-column prop="status" label="çŠ¶æ€" width="100"><template #default="scope"><el-tag :type="getStatusType(scope.row.status)">{{ getStatusText(scope.row.status) }}</el-tag></template></el-table-column>
                    <el-table-column prop="description" label="é—®é¢˜æè¿°" show-overflow-tooltip />
                    <el-table-column prop="create_date" label="åˆ›å»ºæ—¥æœŸ" width="120" />
                    <el-table-column prop="handler" label="å¤„ç†äºº" width="100" />
                    <el-table-column label="æ“ä½œ" width="200"><template #default="scope"><el-button size="small" @click="viewTicket(scope.row)">æŸ¥çœ‹</el-button><el-button size="small" type="primary" @click="handleTicket(scope.row)" v-if="scope.row.status === 'pending'">å¤„ç†</el-button></template></el-table-column>
                </el-table>
            </div>
        </div>
    </div>
    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    loading: false,
                    tickets: [],
                    statistics: { total_tickets: 0, pending: 0, processing: 0, completed: 0 },
                    filters: { ticket_no: '', type: '', status: '' }
                }
            },
            mounted() { this.loadTickets(); },
            methods: {
                async loadTickets() {
                    this.loading = true;
                    try {
                        const res = await axios.get('/api/after-sales/tickets', { params: this.filters });
                        this.tickets = res.data.tickets || [];
                    } catch (error) {
                        ElementPlus.ElMessage.error('åŠ è½½å¤±è´¥: ' + error.message);
                    } finally {
                        this.loading = false;
                    }
                },
                showAddDialog() { ElementPlus.ElMessage.info('æ–°å¢åŠŸèƒ½å¼€å‘ä¸­'); },
                handleTicket(row) { ElementPlus.ElMessage.info('å¤„ç†åŠŸèƒ½å¼€å‘ä¸­'); },
                viewTicket(row) { window.open(`/after-sales/tickets/${row.id}`, '_blank'); },
                getStatusType(status) {
                    const types = { 'pending': 'warning', 'processing': 'primary', 'completed': 'success' };
                    return types[status] || 'info';
                },
                getStatusText(status) {
                    const texts = { 'pending': 'å¾…å¤„ç†', 'processing': 'å¤„ç†ä¸­', 'completed': 'å·²å®Œæˆ' };
                    return texts[status] || status;
                },
                getTypeText(type) {
                    const texts = { 'complaint': 'æŠ•è¯‰', 'repair': 'ç»´ä¿®', 'return': 'é€€è´§' };
                    return texts[type] || type;
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>


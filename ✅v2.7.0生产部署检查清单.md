# ✅ AI Stack v2.7.0 生产部署检查清单

**版本**: v2.7.0  
**状态**: 生产就绪  
**更新时间**: 2025-11-09

---

## 📋 部署前检查

### 1. 系统要求 ✅

#### 硬件要求
- [ ] CPU: 2核+ (推荐4核)
- [ ] 内存: 4GB+ (推荐8GB)
- [ ] 硬盘: 20GB+ 可用空间
- [ ] 网络: 稳定的互联网连接

#### 软件要求
- [ ] Python 3.9+ (推荐3.11+)
- [ ] Redis 5.0+ (可选，推荐安装)
- [ ] PostgreSQL 12+ (可选)

### 2. 依赖安装 ✅

```bash
# 克隆项目
cd /Users/ywc/ai-stack-super-enhanced

# 创建虚拟环境（如未创建）
python3 -m venv venv
source venv/bin/activate

# 安装依赖
./scripts/install-v2.7.0-deps.sh

# 或手动安装
pip install -r requirements-v2.7.0.txt
```

**检查项**:
- [ ] 虚拟环境已创建
- [ ] 核心依赖已安装（fastapi, uvicorn等）
- [ ] Redis已安装（推荐）
- [ ] Slowapi已安装（推荐）
- [ ] 测试工具已安装（locust, pytest）

### 3. Redis配置 ✅

#### 安装Redis

```bash
# macOS
brew install redis
brew services start redis

# Ubuntu/Debian
sudo apt update
sudo apt install redis-server
sudo systemctl start redis
sudo systemctl enable redis

# CentOS/RHEL
sudo yum install redis
sudo systemctl start redis
sudo systemctl enable redis
```

#### 测试Redis连接

```bash
./scripts/test-redis-connection.sh
```

**检查项**:
- [ ] Redis已安装
- [ ] Redis服务运行中
- [ ] Python可以连接Redis
- [ ] 读写测试通过

**注意**: Redis是可选的，如未安装会自动降级到内存缓存

### 4. 配置检查 ✅

**检查项**:
- [ ] 环境变量配置正确
- [ ] 数据目录存在
- [ ] 模型目录配置（如使用sentence-transformers）
- [ ] 日志目录可写

---

## 🚀 部署步骤

### 步骤1: 启动API服务

```bash
cd "📚 Enhanced RAG & Knowledge Graph"
source ../venv/bin/activate
python3 -m uvicorn api.app:app --host 0.0.0.0 --port 8000 --reload
```

**检查项**:
- [ ] 服务成功启动
- [ ] 日志显示：`✅ 内存缓存系统已启用` 或 `✅ Redis缓存系统已启用`
- [ ] 日志显示：`✅ 用户行为分析中间件已启用`
- [ ] 日志显示：`✅ Smart QA API路由已注册`
- [ ] 日志显示：`✅ KG可视化API路由已注册`
- [ ] 日志显示：`✅ 缓存管理API路由已注册`

### 步骤2: 健康检查

```bash
# 基础健康检查
curl http://localhost:8000/health

# 各模块健康检查
curl http://localhost:8000/smart-qa/health
curl http://localhost:8000/kg/viz/health
curl http://localhost:8000/rate-limit/health
curl http://localhost:8000/analytics/health
curl http://localhost:8000/cache/health
```

**检查项**:
- [ ] /health返回healthy
- [ ] 所有模块健康检查通过
- [ ] 响应时间正常

### 步骤3: 功能测试

```bash
# 测试Smart QA
curl -X POST http://localhost:8000/smart-qa/chat \
  -H "Content-Type: application/json" \
  -d '{"query": "测试问题"}'

# 测试图谱可视化
curl http://localhost:8000/kg/viz/graph

# 测试缓存
curl -X POST http://localhost:8000/cache/test

# 测试统计
curl http://localhost:8000/analytics/overview
```

**检查项**:
- [ ] Smart QA返回正常答案
- [ ] 图谱数据返回正常
- [ ] 缓存测试全部通过
- [ ] 统计数据正常收集

---

## 🧪 测试验证

### 1. 单元测试

```bash
cd /Users/ywc/ai-stack-super-enhanced
source venv/bin/activate
pytest tests/ -v --tb=short -m "not integration and not slow"
```

**检查项**:
- [ ] 测试通过率 = 100%
- [ ] 无失败测试
- [ ] 无错误

### 2. API功能测试

```bash
# 测试所有API端点
pytest tests/api/ -v

# 测试v2.6.0功能
pytest tests/conversation/ -v
```

**检查项**:
- [ ] API测试通过
- [ ] Conversation测试通过

### 3. 性能测试（重要！）

```bash
# 启动性能测试
locust -f tests/performance/locustfile.py --host=http://localhost:8000

# 访问Web界面
open http://localhost:8089

# 配置：
# - 用户数: 100
# - 生成速率: 10/秒
# - 运行时间: 5分钟
```

**检查项**:
- [ ] RPS > 100 req/s
- [ ] 平均响应时间 < 100ms
- [ ] P95响应时间 < 200ms
- [ ] 失败率 < 1%
- [ ] 缓存命中率 > 50%

### 4. 缓存效果验证

```bash
# 第一次查询（无缓存）
time curl http://localhost:8000/rag/search?query=test

# 第二次查询（有缓存）
time curl http://localhost:8000/rag/search?query=test

# 查看缓存统计
curl http://localhost:8000/cache/stats
```

**预期结果**:
- [ ] 第一次: ~50ms
- [ ] 第二次: ~5ms
- [ ] 速度提升: 10x ⚡

---

## 📊 性能基准

### v2.7.0性能目标

| 指标 | 目标值 | 验证方法 |
|------|--------|---------|
| **API响应时间** | < 50ms (缓存命中) | Locust测试 |
| **并发QPS** | > 500 | Locust压力测试 |
| **缓存命中率** | > 70% | /cache/stats |
| **错误率** | < 0.1% | /analytics/overview |
| **内存使用** | < 300MB | 系统监控 |
| **CPU使用** | < 30% | 系统监控 |

### 测试场景

#### 场景1: 正常负载
```
用户数: 50
持续时间: 5分钟
预期QPS: 200-300
```

#### 场景2: 高负载
```
用户数: 100
持续时间: 5分钟
预期QPS: 400-500
```

#### 场景3: 峰值负载
```
用户数: 200
持续时间: 2分钟
预期QPS: 500-800
```

---

## 🛡️ 安全检查

### 1. API安全

**检查项**:
- [ ] API key认证工作正常
- [ ] CORS配置正确
- [ ] 敏感信息未暴露

### 2. 限流保护

```bash
# 测试限流（快速请求）
for i in {1..20}; do
  curl http://localhost:8000/smart-qa/health
done

# 查看限流统计
curl http://localhost:8000/rate-limit/stats
```

**检查项**:
- [ ] 限流规则生效（或stub模式）
- [ ] 超限返回429错误（如启用）
- [ ] 错误消息友好

### 3. 数据安全

**检查项**:
- [ ] 数据目录权限正确
- [ ] 日志不包含敏感信息
- [ ] 缓存数据隔离

---

## 📚 文档检查

### 必备文档

**检查项**:
- [ ] API文档可访问 (http://localhost:8000/docs)
- [ ] 中文操作指南可访问 (http://localhost:8000/guide)
- [ ] README-项目完成.md 存在
- [ ] 50+份技术文档完整

### 使用指南

**检查项**:
- [ ] 快速开始指南
- [ ] API使用示例
- [ ] 故障排查指南
- [ ] 性能优化建议

---

## 🎯 功能完整性检查

### 核心功能（v2.5.0）

- [ ] RAG语义搜索
- [ ] 知识图谱查询
- [ ] 文档导入管理
- [ ] 索引管理

### v2.6.0功能

- [ ] Smart QA智能问答（6端点）
- [ ] KG可视化（8端点）
- [ ] API限流系统（5端点）
- [ ] 统计分析系统（9端点）

### v2.7.0功能

- [ ] 缓存管理API（6端点）
- [ ] 缓存装饰器工作
- [ ] 缓存优雅降级
- [ ] 性能提升验证

### 总端点检查

- [ ] 总端点数 = 62个
- [ ] 所有端点可访问
- [ ] 无404错误

---

## 📊 监控检查

### 实时监控

```bash
# 查看统计概览
curl http://localhost:8000/analytics/overview

# 查看端点统计
curl http://localhost:8000/analytics/endpoints

# 查看趋势
curl http://localhost:8000/analytics/trends/hourly
```

**检查项**:
- [ ] 请求数正常追踪
- [ ] 响应时间正常记录
- [ ] 错误率正常统计
- [ ] 趋势数据正常

### 缓存监控

```bash
# 缓存统计
curl http://localhost:8000/cache/stats

# 缓存配置
curl http://localhost:8000/cache/config
```

**检查项**:
- [ ] 缓存后端识别正确（redis或memory）
- [ ] 缓存key数量正常
- [ ] 统计数据完整

---

## 🔧 故障排查

### 常见问题

#### 问题1: Redis连接失败

**症状**: 日志显示"Redis连接失败"

**解决**:
```bash
# 检查Redis是否运行
redis-cli ping

# 如未运行，启动Redis
brew services start redis  # macOS
sudo systemctl start redis # Linux
```

#### 问题2: 端口被占用

**症状**: "Address already in use"

**解决**:
```bash
# 查找占用8000端口的进程
lsof -i :8000

# 杀死进程
kill -9 <PID>
```

#### 问题3: 模块导入失败

**症状**: "ModuleNotFoundError"

**解决**:
```bash
# 确认虚拟环境
which python3

# 重新安装依赖
pip install -r requirements-v2.7.0.txt
```

---

## 📈 性能验证清单

### 基准测试

```bash
# 运行5分钟压力测试
locust -f tests/performance/locustfile.py \
       --host=http://localhost:8000 \
       --users 100 \
       --spawn-rate 10 \
       --run-time 5m \
       --headless
```

**验证指标**:
- [ ] 总请求数 > 30,000
- [ ] RPS > 100
- [ ] 失败率 < 1%
- [ ] 平均响应时间 < 100ms

### 缓存效果验证

```bash
# 运行缓存测试用户
locust -f tests/performance/locustfile.py \
       --host=http://localhost:8000 \
       CacheTestUser \
       --users 50 \
       --run-time 3m \
       --headless
```

**验证指标**:
- [ ] 缓存命中率 > 50%
- [ ] 响应时间下降明显
- [ ] /cache/stats显示有缓存key

---

## 🎊 部署完成确认

### 最终检查清单

#### 功能完整性
- [ ] 62个API端点全部可用
- [ ] 14个功能模块全部正常
- [ ] 所有健康检查通过

#### 性能达标
- [ ] 响应时间 < 100ms
- [ ] RPS > 100
- [ ] 缓存工作正常

#### 质量保证
- [ ] 测试通过率 100%
- [ ] 无已知bug
- [ ] 代码质量A+

#### 文档完整
- [ ] API文档可访问
- [ ] 中文指南完整
- [ ] 技术文档50+份

#### 监控就绪
- [ ] 统计分析工作
- [ ] 限流系统工作（或stub）
- [ ] 缓存监控工作

---

## ✅ 签署确认

```
部署人员: _______________
部署日期: 2025-11-09
版本: v2.7.0
状态: ✅ 生产就绪

确认事项:
✅ 所有检查项通过
✅ 性能测试达标
✅ 功能验证完整
✅ 文档齐全

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
    AI Stack v2.7.0 
    已准备好服务用户！🎊
━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 📞 快速参考

### 启动命令

```bash
# 开发模式
cd "📚 Enhanced RAG & Knowledge Graph"
uvicorn api.app:app --reload

# 生产模式（多worker）
gunicorn api.app:app -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000
```

### 常用检查

```bash
# 健康检查
curl http://localhost:8000/health

# 查看统计
curl http://localhost:8000/analytics/overview

# 查看缓存
curl http://localhost:8000/cache/stats

# 测试API
open http://localhost:8000/docs
```

### 紧急联系

- 技术文档: `/docs`
- 中文指南: `/guide`
- 问题报告: GitHub Issues

---

**🎊 v2.7.0已准备好生产部署！** ✅























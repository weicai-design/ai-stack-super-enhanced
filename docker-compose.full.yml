version: '3.8'

services:
  # RAG æœåŠ¡
  rag-service:
    build:
      context: ./ğŸ“š Enhanced RAG & Knowledge Graph
      dockerfile: Dockerfile
    ports:
      - "8011:8011"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ“š Enhanced RAG & Knowledge Graph:/app
      - ./models:/app/models
    restart: unless-stopped
    networks:
      - aistack-network

  # ERP åç«¯
  erp-backend:
    build:
      context: ./ğŸ’¼ Intelligent ERP & Business Management
      dockerfile: api/Dockerfile
    ports:
      - "8013:8013"
    environment:
      - PYTHONUNBUFFERED=1
      - DATABASE_URL=sqlite:///./erp.db
    volumes:
      - ./ğŸ’¼ Intelligent ERP & Business Management:/app
      - erp-data:/app/data
    restart: unless-stopped
    networks:
      - aistack-network

  # ERP å‰ç«¯
  erp-frontend:
    build:
      context: ./ğŸ’¼ Intelligent ERP & Business Management/web/frontend
      dockerfile: Dockerfile
    ports:
      - "8012:80"
    depends_on:
      - erp-backend
    restart: unless-stopped
    networks:
      - aistack-network

  # è‚¡ç¥¨æœåŠ¡
  stock-service:
    build:
      context: ./ğŸ“ˆ Intelligent Stock Trading
      dockerfile: Dockerfile
    ports:
      - "8014:8014"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ“ˆ Intelligent Stock Trading:/app
      - stock-data:/app/data
    restart: unless-stopped
    networks:
      - aistack-network

  # è¶‹åŠ¿åˆ†ææœåŠ¡
  trend-service:
    build:
      context: ./ğŸ” Intelligent Trend Analysis
      dockerfile: Dockerfile
    ports:
      - "8015:8015"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ” Intelligent Trend Analysis:/app
      - trend-data:/app/data
    restart: unless-stopped
    networks:
      - aistack-network

  # å†…å®¹åˆ›ä½œæœåŠ¡
  content-service:
    build:
      context: ./ğŸ¨ Intelligent Content Creation
      dockerfile: Dockerfile
    ports:
      - "8016:8016"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ¨ Intelligent Content Creation:/app
      - content-data:/app/data
    restart: unless-stopped
    networks:
      - aistack-network

  # ä»»åŠ¡ä»£ç†æœåŠ¡
  task-agent:
    build:
      context: ./ğŸ¤– Intelligent Task Agent
      dockerfile: Dockerfile
    ports:
      - "8017:8017"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ¤– Intelligent Task Agent:/app
    restart: unless-stopped
    networks:
      - aistack-network

  # èµ„æºç®¡ç†æœåŠ¡
  resource-manager:
    build:
      context: ./ğŸ› ï¸ Resource Management
      dockerfile: Dockerfile
    ports:
      - "8018:8018"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ› ï¸ Resource Management:/app
    privileged: true  # éœ€è¦è®¿é—®ç³»ç»Ÿèµ„æº
    restart: unless-stopped
    networks:
      - aistack-network

  # è‡ªæˆ‘å­¦ä¹ æœåŠ¡
  learning-service:
    build:
      context: ./ğŸ§  Self Learning System
      dockerfile: Dockerfile
    ports:
      - "8019:8019"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      - ./ğŸ§  Self Learning System:/app
      - learning-data:/app/data
    restart: unless-stopped
    networks:
      - aistack-network

  # PostgreSQL æ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=aistack
      - POSTGRES_USER=aistack
      - POSTGRES_PASSWORD=aistack_password
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - aistack-network

  # Redis ç¼“å­˜
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped
    networks:
      - aistack-network

  # Nginx åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/ssl:/etc/nginx/ssl:ro
    depends_on:
      - erp-frontend
      - erp-backend
      - rag-service
      - stock-service
      - trend-service
      - content-service
      - task-agent
      - resource-manager
      - learning-service
    restart: unless-stopped
    networks:
      - aistack-network

networks:
  aistack-network:
    driver: bridge

volumes:
  erp-data:
  stock-data:
  trend-data:
  content-data:
  learning-data:
  postgres-data:
  redis-data:

